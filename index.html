<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All-in-One Study App</title>
    <style>
        /* CSS Variables */
        :root {
            --primary-color: #4f46e5;
            --primary-hover: #4338ca;
            --accent-color: #06b6d4;
            --background: #0f172a;
            --text-color: #f1f5f9;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background);
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(79, 70, 229, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(6, 182, 212, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 0%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            background-attachment: fixed;
            color: var(--text-color);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Button Styles */
        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .btn-stop {
            background: #ef4444;
            border: 2px solid #ef4444;
            color: white;
        }

        .btn-stop:hover {
            background: #dc2626;
            border-color: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.3);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Tools Grid */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .tool-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 2rem;
            transition: var(--transition), opacity 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .tool-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .tool-card h3 {
            font-size: 1.5rem;
            color: white;
            margin-bottom: 0.5rem;
        }

        .tool-card p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        /* Tool Sections - Hidden by default */
        .tool-section {
            display: none;
            text-align: center;
            padding: 2rem 0;
            animation: fadeIn 0.6s ease-in-out;
        }

        .tool-section h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Calculator Styles */
        .calculator {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(79, 70, 229, 0.3);
            margin: 0 auto 2rem auto;
            max-width: 400px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .calculator-display {
            margin-bottom: 1rem;
            position: relative;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 0.75rem;
            padding: 0.25rem;
            border: 2px solid rgba(79, 70, 229, 0.3);
        }

        .calculator-display input {
            width: 100%;
            padding: 1rem;
            font-size: 1.89rem;
            background: rgba(30, 41, 59, 0.9);
            border: none;
            border-radius: 0.5rem;
            text-align: right;
            color: #f1f5f9;
            font-weight: 700;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
            min-height: 60px;
            line-height: 1.2;
        }

        .calculator-mode {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            gap: 0.5rem;
        }

        .mode-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0.25rem;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: var(--transition);
        }

        .mode-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .mode-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .mode-separator {
            color: rgba(255, 255, 255, 0.5);
            font-weight: 300;
        }

        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }

        .calc-btn {
            padding: 0.8rem;
            font-size: 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            min-height: 50px;
        }

        .calc-btn.zero-btn {
            grid-column: span 2;
            text-align: left;
            padding-left: 1.5rem;
        }

        .calc-btn.number {
            background: rgba(255, 255, 255, 0.95);
            color: #2d3748;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .calc-btn.number:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .calc-btn.operator {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .calc-btn.operator:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
        }

        .calc-btn.equals {
            background: var(--accent-color);
            color: white;
            box-shadow: 0 2px 8px rgba(240, 147, 251, 0.3);
        }

        .calc-btn.equals:hover {
            background: #e879f9;
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(240, 147, 251, 0.4);
        }

        .calc-btn.clear {
            background: #ef4444;
            color: white;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }

        .calc-btn.clear:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.4);
        }

        /* Notepad Styles */
        .notepad-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .notepad {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .notepad-toolbar {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            justify-content: flex-start;
            flex-wrap: wrap;
        }

        #notepadText {
            width: 100%;
            min-height: 400px;
            padding: 1rem;
            font-size: 1rem;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(79, 70, 229, 0.3);
            border-radius: 0.5rem;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', monospace;
            color: #f1f5f9;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        #notepadText::placeholder {
            color: rgba(241, 245, 249, 0.6);
        }

        #notepadText:focus {
            outline: none;
            border-color: rgba(79, 70, 229, 0.6);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .saved-files-panel {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(79, 70, 229, 0.3);
            text-align: left;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .saved-files-panel h3 {
            color: white;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .saved-files-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .saved-file-item {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border: 1px solid rgba(79, 70, 229, 0.2);
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }

        .saved-file-item:hover {
            transform: translateY(-2px);
            background: rgba(30, 41, 59, 0.8);
            border-color: rgba(79, 70, 229, 0.4);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.2);
        }

        .file-info strong {
            color: white;
            display: block;
            font-size: 1rem;
        }

        .file-info small {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
        }

        .file-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.75rem;
        }

        .no-files {
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            font-style: italic;
        }

        /* Timer Styles */
        .timer-container {
            max-width: 500px;
            margin: 0 auto;
        }

        .timer-tabs {
            display: flex;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            padding: 0.25rem;
        }

        .timer-tab {
            flex: 1;
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            border-radius: 0.25rem;
            transition: var(--transition);
        }

        .timer-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .timer-display, .stopwatch-display {
            font-size: 4rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 2rem;
            font-family: 'Monaco', 'Menlo', monospace;
            background: rgba(30, 41, 59, 0.8);
            padding: 1rem;
            border-radius: 1rem;
            border: 1px solid rgba(79, 70, 229, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .timer-input {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .timer-input input {
            width: 70px;
            padding: 0.5rem;
            font-size: 1.5rem;
            text-align: center;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(79, 70, 229, 0.3);
            border-radius: 0.5rem;
            color: #f1f5f9;
            backdrop-filter: blur(10px);
        }

        .timer-input span {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .timer-controls, .stopwatch-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .lap-times {
            margin-top: 2rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .lap-time {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
        }

        /* Tool Controls */
        .tool-controls {
            text-align: center;
            margin-top: 2rem;
        }

        /* Study Simulations Styles */
        .simulations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .simulation-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(79, 70, 229, 0.3);
            transition: var(--transition);
            cursor: pointer;
        }

        .simulation-card:hover {
            transform: translateY(-5px);
            border-color: rgba(79, 70, 229, 0.6);
            box-shadow: 0 10px 40px rgba(79, 70, 229, 0.2);
        }

        .simulation-card h3 {
            color: #f1f5f9;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .simulation-card p {
            color: rgba(241, 245, 249, 0.8);
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        .simulation-content {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            border: 1px solid rgba(79, 70, 229, 0.3);
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9rem;
            color: #f1f5f9;
        }

        /* Diagonal Scales Simulation Styles */
        /* Simulations Grid Styles */
        .simulations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .simulation-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 15px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .simulation-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.4);
        }

        .simulation-card h3 {
            margin: 0 0 1rem 0;
            color: #e2e8f0;
            font-size: 1.4rem;
            font-weight: 700;
        }

        .simulation-card p {
            color: rgba(241, 245, 249, 0.8);
            margin-bottom: 1.5rem;
            font-size: 1rem;
            line-height: 1.5;
        }

        .simulation-content {
            color: rgba(241, 245, 249, 0.7);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .simulation-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #9333ea);
        }

        .diagonal-scales-container {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid rgba(79, 70, 229, 0.3);
            margin-bottom: 2rem;
        }

        .scale-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .control-group {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 1px solid rgba(79, 70, 229, 0.3);
        }

        .control-group h4 {
            color: #f1f5f9;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .input-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        .input-row label {
            color: rgba(241, 245, 249, 0.8);
            min-width: 120px;
            font-size: 0.9rem;
        }

        .input-row input, .input-row select {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid rgba(79, 70, 229, 0.3);
            border-radius: 0.25rem;
            background: rgba(30, 41, 59, 0.9);
            color: #f1f5f9;
            font-size: 0.9rem;
        }

        .scale-canvas-container {
            background: #ffffff;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 2rem 0;
            border: 2px solid rgba(79, 70, 229, 0.3);
            overflow: auto;
        }

        .scale-canvas {
            width: 100%;
            min-height: 400px;
            border: 1px solid #ddd;
            cursor: crosshair;
        }

        .scale-info {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 1px solid rgba(79, 70, 229, 0.3);
            margin-top: 1rem;
        }

        .scale-info h4 {
            color: #f1f5f9;
            margin-bottom: 1rem;
        }

        .scale-info p {
            color: rgba(241, 245, 249, 0.8);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .measurement-display {
            background: rgba(79, 70, 229, 0.2);
            border-radius: 0.25rem;
            padding: 0.5rem;
            margin-top: 1rem;
            color: #f1f5f9;
            font-weight: bold;
            text-align: center;
        }

        /* Lectures Styles */
        /* Lecture Interface Styles */
        .add-lecture-section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .add-lecture-section h3 {
            color: #f1f5f9;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lecture-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            color: #f1f5f9;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 0.5rem;
            padding: 0.75rem;
            color: #f1f5f9;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: rgba(59, 130, 246, 0.6);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-start;
            margin-top: 1rem;
        }

        .lectures-display-section {
            margin-top: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section-header h3 {
            color: #f1f5f9;
            margin: 0;
        }

        .lecture-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .lecture-controls input,
        .lecture-controls select {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            color: #f1f5f9;
            font-size: 0.9rem;
        }

        .lectures-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .youtube-video-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 0.75rem;
            overflow: hidden;
            border: 1px solid rgba(6, 182, 212, 0.2);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .youtube-video-card:hover {
            transform: translateY(-2px);
            border-color: rgba(6, 182, 212, 0.4);
            box-shadow: 0 8px 32px rgba(6, 182, 212, 0.15);
        }

        .video-thumbnail-container {
            position: relative;
            width: 100%;
            height: 180px;
            overflow: hidden;
            background: rgba(30, 41, 59, 0.6);
        }

        .video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .youtube-video-card:hover .video-thumbnail {
            transform: scale(1.05);
        }

        .play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .youtube-video-card:hover .play-overlay {
            background: rgba(0, 0, 0, 0.3);
        }

        .play-button {
            background: rgba(255, 255, 255, 0.9);
            color: #1e293b;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            transform: scale(0);
            transition: var(--transition);
        }

        .youtube-video-card:hover .play-button {
            transform: scale(1);
        }

        .delete-btn-thumbnail {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            opacity: 0;
            transition: var(--transition);
        }

        .youtube-video-card:hover .delete-btn-thumbnail {
            opacity: 1;
        }

        .delete-btn-thumbnail:hover {
            background: rgba(239, 68, 68, 0.8);
        }

        .duration-badge {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .video-info {
            padding: 1rem;
        }

        .video-title {
            color: #f1f5f9;
            font-size: 0.95rem;
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 0.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-clamp: 2;
            overflow: hidden;
        }

        .channel-name {
            color: rgba(6, 182, 212, 0.9);
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
            font-weight: 500;
        }

        .video-meta {
            display: flex;
            flex-direction: column;
            gap: 2px;
            font-size: 0.8rem;
            color: rgba(241, 245, 249, 0.6);
        }

        .upload-date, .view-count {
            font-size: 0.8rem;
        }

        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem 2rem;
            color: rgba(241, 245, 249, 0.6);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-state h4 {
            color: #f1f5f9;
            margin-bottom: 0.5rem;
        }

        /* Video Modal Styles */
        .video-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal-content {
            background: rgba(15, 23, 42, 0.95);
            border-radius: 1rem;
            max-width: 90%;
            max-height: 90%;
            width: 1000px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            overflow: hidden;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }

        .modal-header h3 {
            color: #f1f5f9;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            color: #f1f5f9;
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .modal-body {
            padding: 1.5rem;
        }

        #videoPlayerContainer {
            width: 100%;
            height: 400px;
            background: #000;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        #videoPlayerContainer iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0.5rem;
        }

        .lecture-info {
            color: rgba(241, 245, 249, 0.8);
            line-height: 1.6;
        }

        .btn-secondary {
            background: rgba(6, 182, 212, 0.2);
            color: #06b6d4;
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(6, 182, 212, 0.3);
            color: #f1f5f9;
            border-color: rgba(6, 182, 212, 0.6);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .lecture-controls {
                flex-direction: column;
            }
        }

        /* Study Material Styles */
        .study-material-grid {
            display: flex;
            flex-direction: column;
            gap: 3rem;
        }

        .material-category {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 20px;
            padding: 2rem;
        }

        .material-category h3 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: #f1f5f9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .material-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .material-item {
            background: rgba(51, 65, 85, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .material-item:hover {
            transform: translateY(-5px);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .material-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .material-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(99, 102, 241, 0.2);
            border-radius: 12px;
            flex-shrink: 0;
        }

        .material-info h4 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: #f1f5f9;
        }

        .material-meta {
            font-size: 0.9rem;
            color: #94a3b8;
        }

        .material-description {
            color: #cbd5e1;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .material-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 10px;
        }

        .material-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .tools-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .notepad-container {
                grid-template-columns: 1fr;
            }

            .calculator {
                max-width: 100%;
            }

            .timer-display, .stopwatch-display {
                font-size: 2.5rem;
            }

            .timer-input input {
                width: 60px;
                font-size: 1.2rem;
            }

            .simulations-grid {
                grid-template-columns: 1fr;
            }

            .lectures-grid {
                grid-template-columns: 1fr;
            }

            .lecture-details {
                grid-template-columns: repeat(2, 1fr);
            }

            .lecture-actions {
                flex-direction: column;
            }
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #10b981;
        }

        .notification.error {
            background: #ef4444;
        }

        .notification.warning {
            background: #f59e0b;
        }

        .notification.info {
            background: #3b82f6;
        }

        /* Search Bar Styles */
        .search-container {
            position: relative;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .search-bar {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            font-size: 1.1rem;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(79, 70, 229, 0.3);
            border-radius: 2rem;
            color: #f1f5f9;
            backdrop-filter: blur(20px);
            transition: var(--transition);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            cursor: text;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }

        .search-bar:focus {
            outline: none;
            border-color: rgba(79, 70, 229, 0.6);
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1), 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .search-bar::placeholder {
            color: rgba(241, 245, 249, 0.5);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(241, 245, 249, 0.5);
            font-size: 1.2rem;
            pointer-events: none;
        }

        .search-shortcut {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(241, 245, 249, 0.5);
            font-size: 0.8rem;
            background: rgba(30, 41, 59, 0.6);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            border: 1px solid rgba(79, 70, 229, 0.3);
            pointer-events: none;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(79, 70, 229, 0.3);
            border-radius: 1rem;
            margin-top: 0.5rem;
            max-height: 400px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }

        .search-result-item {
            padding: 1rem;
            border-bottom: 1px solid rgba(79, 70, 229, 0.2);
            cursor: pointer;
            transition: var(--transition);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background: rgba(79, 70, 229, 0.2);
        }

        .search-result-title {
            color: #f1f5f9;
            font-weight: 600;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-result-description {
            color: rgba(241, 245, 249, 0.7);
            font-size: 0.9rem;
        }

        .search-result-type {
            color: rgba(79, 70, 229, 0.8);
            font-size: 0.8rem;
            background: rgba(79, 70, 229, 0.2);
            padding: 0.2rem 0.5rem;
            border-radius: 0.25rem;
            margin-left: auto;
        }

        .no-results {
            padding: 2rem;
            text-align: center;
            color: rgba(241, 245, 249, 0.6);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #10b981;
        }

        .notification.error {
            background: #ef4444;
        }

        .notification.warning {
            background: #f59e0b;
        }

        .notification.info {
            background: #3b82f6;
        }

        /* AI Chatbot Styles */
        .chatbot-container {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            border: 1px solid rgba(6, 182, 212, 0.3);
            overflow: hidden;
            height: 600px;
            display: flex;
            flex-direction: column;
            margin-bottom: 2rem;
        }

        .chat-header {
            background: rgba(30, 41, 59, 0.8);
            padding: 1rem;
            border-bottom: 1px solid rgba(6, 182, 212, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #f1f5f9;
            font-weight: 500;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            gap: 0.75rem;
            max-width: 80%;
        }

        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .assistant-message {
            align-self: flex-start;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .user-message .message-avatar {
            background: var(--primary-color);
            color: white;
        }

        .assistant-message .message-avatar {
            background: rgba(6, 182, 212, 0.2);
        }

        .message-content {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            border: 1px solid rgba(6, 182, 212, 0.2);
        }

        .user-message .message-content {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .message-text {
            color: #f1f5f9;
            line-height: 1.5;
            margin-bottom: 0.25rem;
        }

        .message-time {
            font-size: 0.75rem;
            color: rgba(241, 245, 249, 0.6);
        }

        .chat-input-container {
            border-top: 1px solid rgba(6, 182, 212, 0.2);
            padding: 1rem;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        #chatInput {
            flex: 1;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            color: #f1f5f9;
            font-size: 1rem;
            outline: none;
            transition: var(--transition);
        }

        #chatInput:focus {
            border-color: rgba(6, 182, 212, 0.6);
            box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.2);
        }

        #chatInput::placeholder {
            color: rgba(241, 245, 249, 0.5);
        }

        .send-button {
            background: var(--primary-color);
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-button:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .send-button:disabled {
            background: rgba(79, 70, 229, 0.5);
            cursor: not-allowed;
            transform: none;
        }

        .send-icon {
            font-size: 1.1rem;
        }

        .quick-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            color: rgba(6, 182, 212, 0.9);
            cursor: pointer;
            font-size: 0.85rem;
            transition: var(--transition);
        }

        .quick-action-btn:hover {
            background: rgba(6, 182, 212, 0.2);
            border-color: rgba(6, 182, 212, 0.5);
            color: #f1f5f9;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(241, 245, 249, 0.6);
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 2px;
        }

        .typing-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: rgba(6, 182, 212, 0.6);
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .tool-description {
            color: rgba(241, 245, 249, 0.8);
            margin-bottom: 2rem;
            font-size: 1.1rem;
            text-align: center;
        }

        /* AI Response Formatting Styles */
        .message-text strong {
            color: #06b6d4;
            font-weight: 700;
        }

        .message-text em {
            color: #a855f7;
            font-style: italic;
        }

        .message-text .code-block {
            display: block;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 0.5rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #10b981;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .message-text .inline-code {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 0.25rem;
            padding: 0.2rem 0.4rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #06b6d4;
        }

        .message-text .response-header {
            color: #f97316;
            font-weight: 600;
            margin: 1rem 0 0.5rem 0;
            line-height: 1.2;
        }

        .message-text h1.response-header {
            font-size: 1.4rem;
            border-bottom: 2px solid rgba(249, 115, 22, 0.3);
            padding-bottom: 0.25rem;
        }

        .message-text h2.response-header {
            font-size: 1.2rem;
            border-bottom: 1px solid rgba(249, 115, 22, 0.2);
            padding-bottom: 0.2rem;
        }

        .message-text h3.response-header {
            font-size: 1.1rem;
        }

        .message-text .formatted-list {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }

        .message-text .formatted-list li {
            margin: 0.25rem 0;
            color: #f1f5f9;
            line-height: 1.4;
        }

        .message-text ol.formatted-list {
            list-style-type: decimal;
        }

        .message-text ul.formatted-list {
            list-style-type: disc;
        }

        .message-text .formatted-list li::marker {
            color: #06b6d4;
        }

        /* Enhanced message text spacing */
        .message-text {
            line-height: 1.6;
        }

        .message-text p {
            margin: 0.5rem 0;
        }

        .message-text br + br {
            display: block;
            margin: 0.5rem 0;
        }

        /* Material Management Styles */
        .add-material-section {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(168, 85, 247, 0.1));
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .add-material-section h3 {
            color: #06b6d4;
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }

        .material-form {
            max-width: 800px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            color: #f1f5f9;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 0.5rem;
            color: #f1f5f9;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .form-hint {
            color: rgba(241, 245, 249, 0.6);
            font-size: 0.8rem;
            margin-top: 0.25rem;
            display: block;
        }

        .materials-container {
            margin-top: 2rem;
        }

        .materials-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .materials-header h3 {
            color: #f1f5f9;
            margin: 0;
        }

        .materials-stats {
            display: flex;
            gap: 1rem;
        }

        .stat-item {
            color: rgba(241, 245, 249, 0.8);
            font-size: 0.9rem;
        }

        .stat-item span {
            color: #06b6d4;
            font-weight: 600;
        }

        .category-filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(6, 182, 212, 0.3);
            color: #f1f5f9;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .filter-btn:hover {
            background: rgba(6, 182, 212, 0.1);
            border-color: #06b6d4;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border-color: #06b6d4;
            color: #0f172a;
            font-weight: 600;
        }

        .materials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .material-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.8));
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .material-card:hover {
            transform: translateY(-2px);
            border-color: #06b6d4;
            box-shadow: 0 10px 25px rgba(6, 182, 212, 0.2);
        }

        .material-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .material-info h4 {
            color: #f1f5f9;
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .material-category-badge {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: #0f172a;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .material-description {
            color: rgba(241, 245, 249, 0.8);
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 1rem;
        }

        .material-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .material-actions .btn {
            flex: 1;
            padding: 0.6rem;
            font-size: 0.85rem;
        }

        .material-card .btn-danger {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            border-color: #dc2626;
            color: white;
            flex: 0 0 auto;
            padding: 0.6rem 0.75rem;
        }

        .material-card .btn-danger:hover {
            background: linear-gradient(135deg, #b91c1c, #991b1b);
            transform: translateY(-1px);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            grid-column: 1 / -1;
        }

        .empty-state .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-state h4 {
            color: #f1f5f9;
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: rgba(241, 245, 249, 0.6);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .materials-grid {
                grid-template-columns: 1fr;
            }
            
            .category-filters {
                justify-content: center;
            }
            
            .materials-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }

        /* Fun Learning Styles */
        .fun-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid rgba(6, 182, 212, 0.3);
            padding-bottom: 1rem;
        }

        .fun-nav-btn {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(6, 182, 212, 0.3);
            color: #f1f5f9;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .fun-nav-btn:hover {
            background: rgba(6, 182, 212, 0.1);
            border-color: #06b6d4;
            transform: translateY(-2px);
        }

        .fun-nav-btn.active {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border-color: #06b6d4;
            color: #0f172a;
            box-shadow: 0 5px 15px rgba(6, 182, 212, 0.3);
        }

        .fun-section {
            display: none;
        }

        .fun-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-header h3 {
            color: #f1f5f9;
            margin: 0;
            font-size: 1.3rem;
        }

        /* Flashcard Styles */
        .flashcard-form {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(168, 85, 247, 0.1));
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .flashcard-form h4 {
            color: #06b6d4;
            margin-bottom: 1.5rem;
        }

        .flashcard-study {
            margin-bottom: 2rem;
        }

        .study-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .study-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .study-actions {
            display: flex;
            gap: 0.5rem;
        }

        .category-filter select {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 0.5rem;
            color: #f1f5f9;
            padding: 0.5rem;
        }

        .flashcard-container {
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .flashcard {
            width: 100%;
            max-width: 500px;
            height: 300px;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.8));
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .flashcard:hover {
            transform: translateY(-5px);
            border-color: #06b6d4;
            box-shadow: 0 15px 30px rgba(6, 182, 212, 0.2);
        }

        .flashcard.flipped {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(6, 182, 212, 0.2));
            border-color: #a855f7;
        }

        .flashcard-content {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #f1f5f9;
            word-wrap: break-word;
        }

        .flashcard-type {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(6, 182, 212, 0.8);
            color: #0f172a;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .flashcard.flipped .flashcard-type {
            background: rgba(168, 85, 247, 0.8);
        }

        .flashcard-navigation {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .nav-btn {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border: none;
            color: #0f172a;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(6, 182, 212, 0.3);
        }

        .flip-btn {
            background: linear-gradient(135deg, #a855f7, #9333ea);
        }

        .flashcard-management {
            margin-top: 2rem;
        }

        .flashcard-list {
            display: grid;
            gap: 1rem;
        }

        .flashcard-item {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .flashcard-item-info h5 {
            color: #f1f5f9;
            margin: 0 0 0.25rem 0;
            font-size: 0.9rem;
        }

        .flashcard-item-info p {
            color: rgba(241, 245, 249, 0.7);
            margin: 0;
            font-size: 0.8rem;
        }

        .flashcard-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .flashcard-item-actions .btn {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        /* Quiz Styles */
        .quiz-generator {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(168, 85, 247, 0.1));
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .quiz-generator h4 {
            color: #06b6d4;
            margin-bottom: 1.5rem;
        }

        .generate-btn {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .generate-btn.loading {
            background: linear-gradient(135deg, #64748b, #475569);
            cursor: not-allowed;
        }

        .quiz-container {
            background: rgba(15, 23, 42, 0.9);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .quiz-header {
            margin-bottom: 2rem;
        }

        .quiz-header h4 {
            color: #f1f5f9;
            margin-bottom: 1rem;
        }

        .quiz-progress {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .progress-text {
            color: rgba(241, 245, 249, 0.8);
            font-size: 0.9rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .question-container {
            margin-bottom: 2rem;
        }

        .question-text {
            color: #f1f5f9;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 0.5rem;
            border-left: 4px solid #06b6d4;
        }

        .question-options {
            display: grid;
            gap: 0.75rem;
        }

        .option-btn {
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid rgba(6, 182, 212, 0.3);
            color: #f1f5f9;
            padding: 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 0.9rem;
        }

        .option-btn:hover {
            background: rgba(6, 182, 212, 0.1);
            border-color: #06b6d4;
        }

        .option-btn.selected {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border-color: #06b6d4;
            color: #0f172a;
            font-weight: 600;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
        }

        .quiz-results {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(6, 182, 212, 0.1));
            border: 2px solid rgba(16, 185, 129, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
        }

        .results-header h4 {
            color: #10b981;
            margin-bottom: 2rem;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981, #059669);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }

        .score-circle span {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .results-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .result-item {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .result-item .label {
            color: rgba(241, 245, 249, 0.7);
            font-size: 0.85rem;
            display: block;
            margin-bottom: 0.25rem;
        }

        .result-item .value {
            color: #10b981;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .results-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        /* Statistics Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.8));
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            border-color: #06b6d4;
            box-shadow: 0 10px 25px rgba(6, 182, 212, 0.2);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .stat-number {
            color: #06b6d4;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: rgba(241, 245, 249, 0.8);
            font-size: 0.9rem;
        }

        .recent-activity {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
        }

        .recent-activity h4 {
            color: #f1f5f9;
            margin-bottom: 1rem;
        }

        .activity-list {
            display: grid;
            gap: 0.75rem;
        }

        .activity-item {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-info {
            color: #f1f5f9;
            font-size: 0.9rem;
        }

        .activity-time {
            color: rgba(241, 245, 249, 0.6);
            font-size: 0.8rem;
        }

        .empty-flashcards {
            text-align: center;
            padding: 3rem 2rem;
        }

        .empty-flashcards .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-flashcards h4 {
            color: #f1f5f9;
            margin-bottom: 0.5rem;
        }

        .empty-flashcards p {
            color: rgba(241, 245, 249, 0.6);
        }

        @media (max-width: 768px) {
            .fun-nav {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .section-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .study-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .flashcard-navigation {
                flex-wrap: wrap;
            }
            
            .quiz-controls {
                flex-direction: column;
            }
            
            .results-actions {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        /* Floating Windows & Pop-out Styles */
        .tool-card-header {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            z-index: 2;
        }

        .popout-btn {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
            color: #0f172a;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .popout-btn:hover {
            transform: translateY(-2px) scale(1.1);
            box-shadow: 0 6px 20px rgba(6, 182, 212, 0.4);
            background: linear-gradient(135deg, #0891b2, #0e7490);
        }

        .floating-windows-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 1000;
        }

        .floating-window {
            position: absolute;
            min-width: 300px;
            min-height: 200px;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.98), rgba(30, 41, 59, 0.95));
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 1rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            pointer-events: auto;
            resize: both;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .floating-window.minimized {
            height: 40px !important;
            min-height: 40px;
            resize: none;
        }

        .floating-window.maximized {
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            border-radius: 0;
            resize: none;
        }

        .floating-window:hover {
            border-color: #06b6d4;
            box-shadow: 0 25px 50px rgba(6, 182, 212, 0.2);
        }

        .window-header {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), rgba(168, 85, 247, 0.1));
            border-bottom: 1px solid rgba(6, 182, 212, 0.3);
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            user-select: none;
        }

        .window-title {
            color: #f1f5f9;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .window-controls {
            display: flex;
            gap: 0.5rem;
        }

        .window-control-btn {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .minimize-btn {
            background: #f59e0b;
            color: #78350f;
        }

        .maximize-btn {
            background: #10b981;
            color: #064e3b;
        }

        .close-btn {
            background: #ef4444;
            color: #7f1d1d;
        }

        .window-control-btn:hover {
            transform: scale(1.1);
            filter: brightness(1.1);
        }

        .window-content {
            height: calc(100% - 50px);
            overflow: auto;
            padding: 1rem;
        }

        .floating-window.minimized .window-content {
            display: none;
        }

        /* Taskbar for minimized windows */
        .floating-taskbar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.9);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 2rem;
            padding: 0.5rem 1rem;
            display: flex;
            gap: 0.5rem;
            backdrop-filter: blur(10px);
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .taskbar-item {
            background: rgba(6, 182, 212, 0.2);
            border: 1px solid rgba(6, 182, 212, 0.4);
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            cursor: pointer;
            color: #f1f5f9;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .taskbar-item:hover {
            background: rgba(6, 182, 212, 0.3);
            transform: translateY(-2px);
        }

        .taskbar-item.active {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: #0f172a;
        }

        /* Drag visual feedback - Enhanced for smooth performance */
        .window-dragging {
            opacity: 0.9;
            transform: scale(1.02) !important;
            z-index: 1002;
            transition: none !important;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4) !important;
            cursor: grabbing !important;
        }

        .floating-window {
            will-change: transform;
            backface-visibility: hidden;
            transform: translateZ(0);
        }

        .window-header {
            cursor: grab;
            user-select: none;
        }

        .window-header:active {
            cursor: grabbing;
        }

        .snap-zone {
            position: fixed;
            background: rgba(6, 182, 212, 0.2);
            border: 2px dashed #06b6d4;
            border-radius: 0.5rem;
            pointer-events: none;
            z-index: 999;
            transition: all 0.2s ease;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .floating-window {
                min-width: 280px;
                max-width: 90vw;
            }
            
            .floating-taskbar {
                bottom: 10px;
                left: 10px;
                right: 10px;
                transform: none;
                border-radius: 1rem;
            }
            
            .taskbar-item {
                flex: 1;
                justify-content: center;
                padding: 0.75rem 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>All-in-One Study App</h1>
            <p>Your complete toolkit for studying and productivity</p>
        </div>

        <!-- Search Bar -->
        <div class="search-container">
            <div class="search-icon"></div>
            <input type="text" class="search-bar" id="search-input" placeholder="Search tools, simulations, lectures... (Ctrl+K)" autocomplete="off" spellcheck="false">
            <div class="search-shortcut">Ctrl+K</div>
            <div class="search-results" id="searchResults"></div>
        </div>

        <!-- Main Tools Grid -->
        <div id="toolsGrid" class="tools-grid">
            <div class="tool-card">
                <div class="tool-card-header">
                    <button class="popout-btn" onclick="openFloatingWindow('calculator')" title="Open in floating window"></button>
                </div>
                <div class="tool-icon"></div>
                <h3>Calculator</h3>
                <p>Basic and scientific calculator</p>
                <button class="btn btn-primary" onclick="showTool('calculator')">Use Calculator</button>
            </div>
            <div class="tool-card">
                <div class="tool-card-header">
                    <button class="popout-btn" onclick="openFloatingWindow('notepad')" title="Open in floating window"></button>
                </div>
                <div class="tool-icon"></div>
                <h3>Notepad</h3>
                <p>Simple text editor and notes</p>
                <button class="btn btn-primary" onclick="showTool('notepad')">Open Notepad</button>
            </div>
            <div class="tool-card">
                <div class="tool-card-header">
                    <button class="popout-btn" onclick="openFloatingWindow('timer')" title="Open in floating window"></button>
                </div>
                <div class="tool-icon"></div>
                <h3>Timer</h3>
                <p>Countdown timer and stopwatch</p>
                <button class="btn btn-primary" onclick="showTool('timer')">Open Timer</button>
            </div>
            <div class="tool-card" onclick="showTool('simulations')">
                <div class="tool-icon"></div>
                <h3>Study Simulations</h3>
                <p>Interactive learning simulations</p>
                <button class="btn btn-primary">View Simulations</button>
            </div>
            <div class="tool-card" onclick="showTool('lectures')">
                <div class="tool-icon"></div>
                <h3>Lectures</h3>
                <p>Educational content and courses</p>
                <button class="btn btn-primary">Browse Lectures</button>
            </div>
            <div class="tool-card">
                <div class="tool-card-header">
                    <button class="popout-btn" onclick="openFloatingWindow('ai-chatbot')" title="Open in floating window"></button>
                </div>
                <div class="tool-icon"></div>
                <h3>AI Study Assistant</h3>
                <p>Get help with study doubts and questions</p>
                <button class="btn btn-primary" onclick="showTool('ai-chatbot')">Start Chat</button>
            </div>
            <div class="tool-card" onclick="showTool('study-material')">
                <div class="tool-icon"></div>
                <h3>Study Material</h3>
                <p>PYQs, assignments, and study resources</p>
                <button class="btn btn-primary">Browse Materials</button>
            </div>
            <div class="tool-card" onclick="showTool('fun')">
                <div class="tool-icon"></div>
                <h3>Fun Learning</h3>
                <p>Interactive flashcards and AI-generated quizzes</p>
                <button class="btn btn-primary">Start Learning</button>
            </div>
        </div>

        <!-- Calculator Tool -->
        <div id="calculatorTool" class="tool-section">
            <h2>Calculator</h2>
            <div class="calculator">
                <div class="calculator-display">
                    <input type="text" id="calculatorInput" readonly value="0">
                </div>
                <div class="calculator-mode">
                    <button class="mode-btn active" id="degreeMode" onclick="toggleAngleMode()">DEG</button>
                    <span class="mode-separator">|</span>
                    <button class="mode-btn" id="radianMode" onclick="toggleAngleMode()">RAD</button>
                </div>
                <div class="calculator-buttons">
                    <button class="calc-btn clear" onclick="clearCalculator()">C</button>
                    <button class="calc-btn operator" onclick="appendToCalculator('(')">(</button>
                    <button class="calc-btn operator" onclick="appendToCalculator(')')">)</button>
                    <button class="calc-btn operator" onclick="deleteLastCalculator()"></button>
                    
                    <button class="calc-btn operator" onclick="appendTrigFunction('sin')">sin</button>
                    <button class="calc-btn operator" onclick="appendTrigFunction('cos')">cos</button>
                    <button class="calc-btn operator" onclick="appendTrigFunction('tan')">tan</button>
                    <button class="calc-btn operator" onclick="appendToCalculator('')"></button>
                    
                    <button class="calc-btn operator" onclick="appendTrigFunction('asin')">sin</button>
                    <button class="calc-btn operator" onclick="appendTrigFunction('acos')">cos</button>
                    <button class="calc-btn operator" onclick="appendTrigFunction('atan')">tan</button>
                    <button class="calc-btn operator" onclick="appendToCalculator('log(')">log</button>
                    
                    <button class="calc-btn operator" onclick="appendTrigFunction('sec')">sec</button>
                    <button class="calc-btn operator" onclick="appendTrigFunction('csc')">csc</button>
                    <button class="calc-btn operator" onclick="appendTrigFunction('cot')">cot</button>
                    <button class="calc-btn operator" onclick="appendToCalculator('^')">^</button>
                    
                    <button class="calc-btn operator" onclick="appendToCalculator('/')">/</button>
                    <button class="calc-btn operator" onclick="appendToCalculator('*')"></button>
                    <button class="calc-btn operator" onclick="appendToCalculator('-')">-</button>
                    <button class="calc-btn operator" onclick="appendToCalculator('+')">+</button>
                    
                    <button class="calc-btn number" onclick="appendToCalculator('7')">7</button>
                    <button class="calc-btn number" onclick="appendToCalculator('8')">8</button>
                    <button class="calc-btn number" onclick="appendToCalculator('9')">9</button>
                    <button class="calc-btn operator" onclick="appendToCalculator('!')">!</button>
                    
                    <button class="calc-btn number" onclick="appendToCalculator('4')">4</button>
                    <button class="calc-btn number" onclick="appendToCalculator('5')">5</button>
                    <button class="calc-btn number" onclick="appendToCalculator('6')">6</button>
                    <button class="calc-btn number" onclick="appendToCalculator('.')">.</button>
                    
                    <button class="calc-btn number" onclick="appendToCalculator('1')">1</button>
                    <button class="calc-btn number" onclick="appendToCalculator('2')">2</button>
                    <button class="calc-btn number" onclick="appendToCalculator('3')">3</button>
                    <button class="calc-btn equals" onclick="calculateResult()" style="grid-row: span 2;">=</button>
                    
                    <button class="calc-btn number zero-btn" onclick="appendToCalculator('0')">0</button>
                </div>
            </div>
            <div class="tool-controls">
                <button class="btn btn-outline" onclick="showTool('home')"> Back to Tools</button>
            </div>
        </div>

        <!-- Notepad Tool -->
        <div id="notepadTool" class="tool-section">
            <h2>Notepad</h2>
            <div class="notepad-container">
                <div class="notepad">
                    <div class="notepad-toolbar">
                        <button class="btn btn-small" onclick="saveNote()"> Save</button>
                        <button class="btn btn-small" onclick="clearNote()"> Clear</button>
                        <button class="btn btn-small" onclick="downloadNote()"> Download</button>
                    </div>
                    <textarea id="notepadText" placeholder="Start typing your notes here..."></textarea>
                </div>
                <div class="saved-files-panel">
                    <h3>Saved Files</h3>
                    <div id="savedFilesList" class="saved-files-list">
                        <p class="no-files">No saved files</p>
                    </div>
                </div>
            </div>
            <div class="tool-controls">
                <button class="btn btn-outline" onclick="showTool('home')"> Back to Tools</button>
            </div>
        </div>

        <!-- Timer Tool -->
        <div id="timerTool" class="tool-section">
            <h2>Timer & Stopwatch</h2>
            <div class="timer-container">
                <div class="timer-tabs">
                    <button class="timer-tab active" id="timerTab" onclick="switchTimerTab('timer')">Timer</button>
                    <button class="timer-tab" id="stopwatchTab" onclick="switchTimerTab('stopwatch')">Stopwatch</button>
                </div>
                
                <div class="timer-section" id="timerSection">
                    <div class="timer-display" id="timerDisplay">00:05:00</div>
                    <div class="timer-input">
                        <input type="number" id="timerHours" min="0" max="23" value="0" placeholder="HH">
                        <span>:</span>
                        <input type="number" id="timerMinutes" min="0" max="59" value="5" placeholder="MM">
                        <span>:</span>
                        <input type="number" id="timerSeconds" min="0" max="59" value="0" placeholder="SS">
                    </div>
                    <div class="timer-controls">
                        <button class="btn btn-primary" id="startTimer" onclick="startTimer()">Start</button>
                        <button class="btn btn-outline" id="resetTimer" onclick="resetTimer()">Reset</button>
                    </div>
                </div>
                
                <div class="stopwatch-section" id="stopwatchSection" style="display: none;">
                    <div class="stopwatch-display" id="stopwatchDisplay">00:00:00</div>
                    <div class="stopwatch-controls">
                        <button class="btn btn-primary" id="startStopwatch" onclick="startStopwatch()">Start</button>
                        <button class="btn btn-outline" onclick="lapStopwatch()">Lap</button>
                        <button class="btn btn-outline" onclick="resetStopwatch()">Reset</button>
                    </div>
                    <div class="lap-times" id="lapTimes"></div>
                </div>
            </div>
            <div class="tool-controls">
                <button class="btn btn-outline" onclick="showTool('home')"> Back to Tools</button>
            </div>
        </div>

        <!-- Study Simulations Tool -->
        <div id="simulationsTool" class="tool-section">
            <h2>Study Simulations</h2>
            
            <div class="simulations-grid">
                <div class="simulation-card" onclick="openSimulation('engineering-graphics')">
                    <h3> Engineering Graphics</h3>
                    <p>Interactive diagonal scales and technical drafting</p>
                    <div class="simulation-content">
                        <strong>Learn About:</strong><br>
                         Diagonal Scale Construction<br>
                         Precise Measurements<br>
                         Engineering Drawings<br>
                         Drafting Techniques
                    </div>
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-primary">Start Simulation</button>
                    </div>
                </div>

                <div class="simulation-card" onclick="openSimulation('physics')">
                    <h3> Physics Lab</h3>
                    <p>Interactive physics experiments and demonstrations</p>
                    <div class="simulation-content">
                        <strong>Available Experiments:</strong><br>
                         Projectile Motion<br>
                         Wave Interference<br>
                         Electric Fields<br>
                         Pendulum Motion
                    </div>
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-primary">Coming Soon</button>
                    </div>
                </div>

                <div class="simulation-card" onclick="openSimulation('chemistry')">
                    <h3> Chemistry Lab</h3>
                    <p>Virtual chemical reactions and molecular modeling</p>
                    <div class="simulation-content">
                        <strong>Available Reactions:</strong><br>
                         Acid-Base Titration<br>
                         Molecular Bonding<br>
                         Chemical Equilibrium<br>
                         Periodic Trends
                    </div>
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-primary">Coming Soon</button>
                    </div>
                </div>

                <div class="simulation-card" onclick="openSimulation('math')">
                    <h3> Math Visualizer</h3>
                    <p>Mathematical concepts with visual representations</p>
                    <div class="simulation-content">
                        <strong>Available Tools:</strong><br>
                         Function Graphing<br>
                         Geometry Proofs<br>
                         Statistics Plots<br>
                         Calculus Visualization
                    </div>
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-primary">Coming Soon</button>
                    </div>
                </div>
            </div>

            <!-- Engineering Graphics Simulation (Initially Hidden) -->
            <div id="engineeringGraphicsSimulation" class="diagonal-scales-container" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h3> Interactive Diagonal Scales Tutorial</h3>
                    <button class="btn btn-outline" onclick="showSimulationsList()"> Back to Simulations</button>
                </div>
                <p style="color: rgba(241, 245, 249, 0.8); margin-bottom: 2rem;">
                    Learn how to construct and use diagonal scales for precise measurements in engineering drawings. 
                    This interactive simulation will guide you through the principles and applications of diagonal scales.
                </p>

                <div class="scale-controls">
                    <div class="control-group">
                        <h4>Scale Parameters</h4>
                        <div class="input-row">
                            <label>Maximum Value:</label>
                            <input type="number" id="maxValue" value="100" min="10" max="1000">
                        </div>
                        <div class="input-row">
                            <label>Major Divisions:</label>
                            <input type="number" id="majorDivisions" value="10" min="5" max="20">
                        </div>
                        <div class="input-row">
                            <label>Minor Divisions:</label>
                            <input type="number" id="minorDivisions" value="10" min="5" max="20">
                        </div>
                        <div class="input-row">
                            <label>Scale Length (cm):</label>
                            <input type="number" id="scaleLength" value="15" min="10" max="25">
                        </div>
                    </div>

                    <div class="control-group">
                        <h4>Measurement Tool</h4>
                        <div class="input-row">
                            <label>Target Value:</label>
                            <input type="number" id="targetValue" value="23.7" min="0" step="0.1">
                        </div>
                        <div class="input-row">
                            <label>Scale Type:</label>
                            <select id="scaleType">
                                <option value="diagonal">Diagonal Scale</option>
                                <option value="plain">Plain Scale (Comparison)</option>
                            </select>
                        </div>
                        <div class="input-row">
                            <label>Show Construction:</label>
                            <input type="checkbox" id="showConstruction" checked>
                        </div>
                        <button class="btn btn-primary" onclick="drawDiagonalScale()" style="margin-top: 1rem; width: 100%;">
                             Generate Scale
                        </button>
                    </div>
                </div>

                <div class="scale-canvas-container">
                    <canvas id="scaleCanvas" class="scale-canvas" width="800" height="500"></canvas>
                </div>

                <div class="measurement-display" id="measurementDisplay">
                    Click "Generate Scale" to begin the interactive tutorial
                </div>

                <div class="scale-info">
                    <h4> Understanding Diagonal Scales</h4>
                    <p><strong>What is a Diagonal Scale?</strong> A diagonal scale is used when very small distances are to be measured accurately. It allows reading up to three units (e.g., meters, decimeters, centimeters).</p>
                    
                    <p><strong>Construction Principle:</strong> The scale uses diagonal lines to subdivide the smallest divisions of a plain scale, providing higher precision in measurements.</p>
                    
                    <p><strong>Applications:</strong></p>
                    <ul style="color: rgba(241, 245, 249, 0.8); margin-left: 1.5rem;">
                        <li>Precise measurements in engineering drawings</li>
                        <li>Architectural plans and blueprints</li>
                        <li>Surveying and mapping</li>
                        <li>Technical illustration and drafting</li>
                    </ul>

                    <p><strong>How to Read:</strong></p>
                    <ol style="color: rgba(241, 245, 249, 0.8); margin-left: 1.5rem;">
                        <li>Locate the major division (units)</li>
                        <li>Find the minor division (tenths)</li>
                        <li>Follow the diagonal line for hundredths</li>
                        <li>Add all three readings for the final measurement</li>
                    </ol>
                </div>

                <div class="control-group" style="margin-top: 2rem;">
                    <h4> Interactive Exercises</h4>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-outline" onclick="startTutorial()" style="flex: 1; min-width: 150px;">
                             Start Tutorial
                        </button>
                        <button class="btn btn-outline" onclick="practiceMode()" style="flex: 1; min-width: 150px;">
                             Practice Mode
                        </button>
                        <button class="btn btn-outline" onclick="showExample()" style="flex: 1; min-width: 150px;">
                             Show Example
                        </button>
                        <button class="btn btn-outline" onclick="resetScale()" style="flex: 1; min-width: 150px;">
                             Reset
                        </button>
                    </div>
                </div>
            </div>

            <div class="tool-controls">
                <button class="btn btn-outline" onclick="showTool('home')"> Back to Tools</button>
            </div>
        </div>

        <!-- Lectures Tool -->
        <div id="lecturesTool" class="tool-section">
            <h2>My Lecture Library</h2>
            
            <!-- Add Lecture Form -->
            <div class="add-lecture-section">
                <h3> Add YouTube Lecture</h3>
                <div class="lecture-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="lectureTitle">Lecture Title</label>
                            <input type="text" id="lectureTitle" placeholder="Enter lecture title">
                        </div>
                        <div class="form-group">
                            <label for="lectureURL">YouTube URL</label>
                            <input type="url" id="lectureURL" placeholder="https://www.youtube.com/watch?v=...">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="addLecture()">
                             Add Lecture
                        </button>
                    </div>
                </div>
            </div>

            <!-- Lectures Display -->
            <div class="lectures-display-section">
                <div class="section-header">
                    <h3> Your YouTube Lectures</h3>
                    <div class="lecture-controls">
                        <input type="text" id="lectureSearch" placeholder="Search lectures..." onkeyup="searchLectures()">
                    </div>
                </div>
                
                <div id="lecturesGrid" class="lectures-grid">
                    <div class="empty-state">
                        <div class="empty-icon"></div>
                        <h4>No lectures added yet</h4>
                        <p>Add your first lecture using the form above to get started!</p>
                    </div>
                </div>
            </div>

            <!-- Video Player Modal -->
            <div id="videoPlayerModal" class="video-modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modalLectureTitle">Lecture Title</h3>
                        <button class="close-btn" onclick="closeVideoPlayer()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div id="videoPlayerContainer">
                            <!-- Video player will be inserted here -->
                        </div>
                        <div class="lecture-info">
                            <div id="modalLectureDetails"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tool-controls">
                <button class="btn btn-outline" onclick="showTool('home')"> Back to Tools</button>
            </div>
        </div>

        <!-- Study Material Tool -->
        <div id="study-materialTool" class="tool-section">
            <h2>Study Material</h2>
            <p class="tool-description">Add and manage your study materials, assignments, and PYQs with Google Drive links</p>
            
            <!-- Add Material Form -->
            <div class="add-material-section">
                <h3> Add New Material</h3>
                <div class="material-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="materialTitle"> Title</label>
                            <input type="text" id="materialTitle" placeholder="e.g., Mathematics PYQs 2024, Physics Lab Manual" maxlength="100">
                        </div>
                        <div class="form-group">
                            <label for="materialCategory"> Category</label>
                            <select id="materialCategory">
                                <option value="pyq"> Previous Year Questions</option>
                                <option value="assignment"> Assignment</option>
                                <option value="notes"> Study Notes</option>
                                <option value="lab"> Lab Manual</option>
                                <option value="other"> Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="materialLink"> Google Drive Link</label>
                        <input type="url" id="materialLink" placeholder="https://drive.google.com/file/d/..." required>
                        <small class="form-hint">Make sure your Google Drive file is set to "Anyone with the link can view"</small>
                    </div>
                    <div class="form-group">
                        <label for="materialDescription"> Description (Optional)</label>
                        <textarea id="materialDescription" placeholder="Brief description of the material..." rows="2" maxlength="200"></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="addMaterial()">
                        <span> Add Material</span>
                    </button>
                </div>
            </div>

            <!-- Materials Display -->
            <div class="materials-container">
                <div class="materials-header">
                    <h3> Your Study Materials</h3>
                    <div class="materials-stats" id="materialsStats">
                        <span class="stat-item">Total: <span id="totalMaterials">0</span></span>
                    </div>
                </div>
                
                <!-- Category Filters -->
                <div class="category-filters">
                    <button class="filter-btn active" onclick="filterMaterials('all')" data-category="all">All</button>
                    <button class="filter-btn" onclick="filterMaterials('pyq')" data-category="pyq"> PYQs</button>
                    <button class="filter-btn" onclick="filterMaterials('assignment')" data-category="assignment"> Assignments</button>
                    <button class="filter-btn" onclick="filterMaterials('notes')" data-category="notes"> Notes</button>
                    <button class="filter-btn" onclick="filterMaterials('lab')" data-category="lab"> Lab</button>
                    <button class="filter-btn" onclick="filterMaterials('other')" data-category="other"> Other</button>
                </div>

                <!-- Materials Grid -->
                <div class="materials-grid" id="materialsGrid">
                    <div class="empty-state" id="emptyState">
                        <div class="empty-icon"></div>
                        <h4>No materials added yet</h4>
                        <p>Add your first study material using the form above!</p>
                    </div>
                </div>
            </div>

            <div class="tool-controls">
                <button class="btn btn-outline" onclick="showTool('home')"> Back to Tools</button>
            </div>
        </div>

        <!-- AI Chatbot Tool -->
        <div id="ai-chatbotTool" class="tool-section">
            <h2> AI Study Assistant</h2>
            <p class="tool-description">Get instant help with your study doubts, explanations, and academic questions!</p>
            
            <!-- Chat Container -->
            <div class="chatbot-container">
                <div class="chat-header">
                    <div class="chat-status">
                        <div class="status-dot online"></div>
                        <span>AI Assistant Online</span>
                    </div>
                    <button class="btn btn-secondary" onclick="clearChat()">Clear Chat</button>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="message assistant-message">
                        <div class="message-avatar"></div>
                        <div class="message-content">
                            <div class="message-text">
                                Hello! I'm your AI Study Assistant. I'm here to help you with any study doubts, explanations, or academic questions you might have. Just type your question below and I'll do my best to help! 
                            </div>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <input type="text" id="chatInput" placeholder="Ask your study question here..." autocomplete="off">
                        <button class="send-button" id="sendButton" onclick="sendMessage()">
                            <span class="send-icon"></span>
                        </button>
                    </div>
                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="insertQuickPrompt('Explain this concept: ')">Explain Concept</button>
                        <button class="quick-action-btn" onclick="insertQuickPrompt('Help me solve: ')">Solve Problem</button>
                        <button class="quick-action-btn" onclick="insertQuickPrompt('What is the difference between: ')">Compare Topics</button>
                        <button class="quick-action-btn" onclick="insertQuickPrompt('Give me examples of: ')">Get Examples</button>
                    </div>
                </div>
            </div>
            
            <div class="tool-controls">
                <button class="btn btn-outline" onclick="showTool('home')"> Back to Tools</button>
            </div>
        </div>

        <!-- Fun Learning Tool -->
        <div id="funTool" class="tool-section">
            <h2> Fun Learning</h2>
            <p class="tool-description">Master concepts with interactive flashcards and AI-generated quizzes!</p>
            
            <!-- Fun Learning Navigation -->
            <div class="fun-nav">
                <button class="fun-nav-btn active" onclick="showFunSection('flashcards')" data-section="flashcards">
                     Flashcards
                </button>
                <button class="fun-nav-btn" onclick="showFunSection('quiz')" data-section="quiz">
                     AI Quiz
                </button>
                <button class="fun-nav-btn" onclick="showFunSection('stats')" data-section="stats">
                     Statistics
                </button>
            </div>

            <!-- Flashcards Section -->
            <div id="flashcardsSection" class="fun-section active">
                <div class="section-header">
                    <h3> Study Flashcards</h3>
                    <button class="btn btn-primary" onclick="showAddFlashcardForm()"> Add Flashcard</button>
                </div>

                <!-- Add Flashcard Form -->
                <div id="addFlashcardForm" class="flashcard-form" style="display: none;">
                    <h4>Create New Flashcard</h4>
                    <div class="form-group">
                        <label for="flashcardQuestion"> Question/Front Side</label>
                        <textarea id="flashcardQuestion" placeholder="Enter the question or front side..." rows="3" maxlength="300"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="flashcardAnswer"> Answer/Back Side</label>
                        <textarea id="flashcardAnswer" placeholder="Enter the answer or back side..." rows="3" maxlength="300"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="flashcardCategory"> Category</label>
                        <input type="text" id="flashcardCategory" placeholder="e.g., Mathematics, Physics, Chemistry" maxlength="50">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="addFlashcard()"> Save Flashcard</button>
                        <button class="btn btn-secondary" onclick="hideAddFlashcardForm()"> Cancel</button>
                    </div>
                </div>

                <!-- Flashcard Study Mode -->
                <div id="flashcardStudy" class="flashcard-study">
                    <div class="study-controls">
                        <div class="study-info">
                            <span id="flashcardCounter">0 / 0</span>
                            <div class="category-filter">
                                <select id="categoryFilter" onchange="filterFlashcards()">
                                    <option value="all">All Categories</option>
                                </select>
                            </div>
                        </div>
                        <div class="study-actions">
                            <button class="btn btn-outline" onclick="shuffleFlashcards()"> Shuffle</button>
                            <button class="btn btn-outline" onclick="resetStudyMode()"> Reset</button>
                        </div>
                    </div>

                    <!-- Flashcard Display -->
                    <div id="flashcardContainer" class="flashcard-container">
                        <div class="empty-flashcards">
                            <div class="empty-icon"></div>
                            <h4>No flashcards yet</h4>
                            <p>Create your first flashcard to start studying!</p>
                        </div>
                    </div>

                    <!-- Study Controls -->
                    <div class="flashcard-navigation" id="flashcardNavigation" style="display: none;">
                        <button class="nav-btn" onclick="previousFlashcard()"> Previous</button>
                        <button class="nav-btn flip-btn" onclick="flipFlashcard()"> Flip Card</button>
                        <button class="nav-btn" onclick="nextFlashcard()"> Next</button>
                    </div>
                </div>

                <!-- Flashcard Management -->
                <div class="flashcard-management">
                    <h4> Manage Flashcards</h4>
                    <div id="flashcardList" class="flashcard-list">
                        <!-- Flashcard list will be populated here -->
                    </div>
                </div>
            </div>

            <!-- AI Quiz Section -->
            <div id="quizSection" class="fun-section">
                <div class="section-header">
                    <h3> AI-Generated Quiz</h3>
                    <div class="quiz-stats" id="quizStats">
                        <span class="stat-item">Quizzes Taken: <span id="quizzesTaken">0</span></span>
                        <span class="stat-item">Best Score: <span id="bestScore">0%</span></span>
                    </div>
                </div>

                <!-- Quiz Generator Form -->
                <div id="quizGeneratorForm" class="quiz-generator">
                    <h4> Generate Custom Quiz</h4>
                    <div class="form-group">
                        <label for="quizTopic"> Topic</label>
                        <input type="text" id="quizTopic" placeholder="e.g., Calculus derivatives, Photosynthesis, Chemical bonding..." maxlength="100" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="quizDifficulty"> Difficulty</label>
                            <select id="quizDifficulty">
                                <option value="easy"> Easy</option>
                                <option value="medium" selected> Medium</option>
                                <option value="hard"> Hard</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="quizQuestions"> Questions</label>
                            <select id="quizQuestions">
                                <option value="5">5 Questions</option>
                                <option value="10" selected>10 Questions</option>
                                <option value="15">15 Questions</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary generate-btn" onclick="generateQuiz()" id="generateQuizBtn">
                        <span class="btn-icon"></span>
                        <span class="btn-text">Generate Quiz</span>
                    </button>
                </div>

                <!-- Quiz Display -->
                <div id="quizContainer" class="quiz-container" style="display: none;">
                    <div class="quiz-header">
                        <h4 id="quizTitle">Quiz Title</h4>
                        <div class="quiz-progress">
                            <div class="progress-text">
                                Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                        </div>
                    </div>

                    <div class="quiz-content">
                        <div class="question-container">
                            <div class="question-text" id="questionText">Question will appear here</div>
                            <div class="question-options" id="questionOptions">
                                <!-- Options will be populated here -->
                            </div>
                        </div>
                    </div>

                    <div class="quiz-controls">
                        <button class="btn btn-outline" onclick="previousQuestion()" id="prevBtn" disabled> Previous</button>
                        <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn">Next </button>
                        <button class="btn btn-success" onclick="submitQuiz()" id="submitBtn" style="display: none;"> Submit Quiz</button>
                    </div>
                </div>

                <!-- Quiz Results -->
                <div id="quizResults" class="quiz-results" style="display: none;">
                    <div class="results-header">
                        <h4> Quiz Complete!</h4>
                        <div class="score-display">
                            <div class="score-circle">
                                <span id="finalScore">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="results-details">
                        <div class="result-item">
                            <span class="label">Correct Answers:</span>
                            <span class="value" id="correctAnswers">0</span>
                        </div>
                        <div class="result-item">
                            <span class="label">Total Questions:</span>
                            <span class="value" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="result-item">
                            <span class="label">Time Taken:</span>
                            <span class="value" id="timeTaken">0:00</span>
                        </div>
                    </div>
                    <div class="results-actions">
                        <button class="btn btn-primary" onclick="resetQuiz()"> Take Another Quiz</button>
                        <button class="btn btn-secondary" onclick="reviewAnswers()"> Review Answers</button>
                    </div>
                </div>
            </div>

            <!-- Statistics Section -->
            <div id="statsSection" class="fun-section">
                <div class="section-header">
                    <h3> Learning Statistics</h3>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"></div>
                        <div class="stat-info">
                            <div class="stat-number" id="totalFlashcards">0</div>
                            <div class="stat-label">Total Flashcards</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"></div>
                        <div class="stat-info">
                            <div class="stat-number" id="studySessions">0</div>
                            <div class="stat-label">Study Sessions</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"></div>
                        <div class="stat-info">
                            <div class="stat-number" id="totalQuizzes">0</div>
                            <div class="stat-label">Quizzes Taken</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"></div>
                        <div class="stat-info">
                            <div class="stat-number" id="averageScore">0%</div>
                            <div class="stat-label">Average Score</div>
                        </div>
                    </div>
                </div>

                <div class="recent-activity">
                    <h4> Recent Activity</h4>
                    <div id="recentActivity" class="activity-list">
                        <!-- Recent activities will be populated here -->
                    </div>
                </div>
            </div>

            <div class="tool-controls">
                <button class="btn btn-outline" onclick="showTool('home')"> Back to Tools</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let timerInterval = null;
        let stopwatchInterval = null;
        let stopwatchTime = 0;
        let lapCounter = 1;
        let angleMode = 'deg'; // 'deg' or 'rad'
        let keySequence = '';
        let sequenceTimeout = null;
        let timerPaused = false;
        let timerRemainingSeconds = 0;

        // Navigation function
        function showTool(toolName) {
            // Hide all tools
            const tools = ['calculatorTool', 'notepadTool', 'timerTool', 'simulationsTool', 'lecturesTool', 'study-materialTool', 'ai-chatbotTool', 'funTool'];
            tools.forEach(tool => {
                document.getElementById(tool).style.display = 'none';
            });

            // Get search container
            const searchContainer = document.querySelector('.search-container');

            if (toolName === 'home') {
                document.getElementById('toolsGrid').style.display = 'grid';
                // Show search bar on homepage
                if (searchContainer) {
                    searchContainer.style.display = 'block';
                }
            } else {
                document.getElementById('toolsGrid').style.display = 'none';
                document.getElementById(toolName + 'Tool').style.display = 'block';
                
                // Hide search bar on tool pages
                if (searchContainer) {
                    searchContainer.style.display = 'none';
                }
                
                // Initialize specific tools
                if (toolName === 'calculator') {
                    initializeCalculator();
                } else if (toolName === 'notepad') {
                    loadNotepadContent();
                } else if (toolName === 'timer') {
                    initializeTimer();
                } else if (toolName === 'simulations') {
                    initializeSimulations();
                } else if (toolName === 'lectures') {
                    initializeLectures();
                } else if (toolName === 'study-material') {
                    initializeStudyMaterial();
                } else if (toolName === 'fun') {
                    initializeFunLearning();
                }
            }
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Angle mode toggle function
        function toggleAngleMode(context = '') {
            const degBtnId = context ? `degreeMode-${context}` : 'degreeMode';
            const radBtnId = context ? `radianMode-${context}` : 'radianMode';
            const degBtn = document.getElementById(degBtnId);
            const radBtn = document.getElementById(radBtnId);
            
            if (!degBtn || !radBtn) return;
            
            if (angleMode === 'deg') {
                angleMode = 'rad';
                degBtn.classList.remove('active');
                radBtn.classList.add('active');
                showNotification('Switched to Radians ', 'info');
            } else {
                angleMode = 'deg';
                radBtn.classList.remove('active');
                degBtn.classList.add('active');
                showNotification('Switched to Degrees ', 'info');
            }
        }

        // Calculator Functions
        function initializeCalculator(context = '') {
            const inputId = context ? `calculatorInput-${context}` : 'calculatorInput';
            const input = document.getElementById(inputId);
            if (input && !input.value) {
                input.value = '0';
            }
            if (input) {
                input.focus();
            }
        }

        function initializeChatbot(context = '') {
            const inputId = context ? `chatInput-${context}` : 'chatInput';
            const input = document.getElementById(inputId);
            
            if (input) {
                // Add Enter key support for chat input
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage(context);
                    }
                });
                
                input.focus();
            }
        }

        function appendTrigFunction(funcName, context = '') {
            const inputId = context ? `calculatorInput-${context}` : 'calculatorInput';
            const input = document.getElementById(inputId);
            if (!input) return;
            
            const currentValue = input.value;
            const lastChar = currentValue.slice(-1);
            
            // Add multiplication if needed
            if (currentValue !== '0' && currentValue !== 'Error' && /\d$/.test(lastChar)) {
                input.value += '' + funcName + '(';
            } else if (currentValue === '0' || currentValue === 'Error') {
                input.value = funcName + '(';
            } else {
                input.value += funcName + '(';
            }
            
            // Focus the input for immediate typing
            input.focus();
        }

        function appendToCalculator(value, context = '') {
            const inputId = context ? `calculatorInput-${context}` : 'calculatorInput';
            const input = document.getElementById(inputId);
            if (!input) return;
            
            const currentValue = input.value;
            
            if (currentValue === '0' && value !== '.' && value !== ')') {
                input.value = value;
            } else if (currentValue === 'Error') {
                input.value = value;
            } else {
                const lastChar = currentValue.slice(-1);
                const operators = ['+', '-', '*', '', '/', '^'];
                
                if (operators.includes(lastChar) && operators.includes(value)) {
                    input.value = currentValue.slice(0, -1) + value;
                } else if (value === ')' && currentValue === '0') {
                    return;
                } else if (value === '(' && /\d$/.test(lastChar)) {
                    input.value += '' + value;
                } else if (value === '') {
                    if (/\d$/.test(lastChar)) {
                        input.value += '';
                    } else {
                        input.value += '';
                    }
                } else if (value === '!') {
                    if (/[\d)]$/.test(lastChar)) {
                        input.value += value;
                    }
                } else {
                    input.value += value;
                }
            }
        }

        function clearCalculator(context = '') {
            const inputId = context ? `calculatorInput-${context}` : 'calculatorInput';
            const input = document.getElementById(inputId);
            if (input) input.value = '0';
        }

        function deleteLastCalculator(context = '') {
            const inputId = context ? `calculatorInput-${context}` : 'calculatorInput';
            const input = document.getElementById(inputId);
            if (!input) return;
            
            if (input.value.length > 1) {
                input.value = input.value.slice(0, -1);
            } else {
                input.value = '0';
            }
        }

        function calculateFactorial(n) {
            if (n < 0) return NaN;
            if (n === 0 || n === 1) return 1;
            if (n > 170) return Infinity;
            
            let result = 1;
            for (let i = 2; i <= n; i++) {
                result *= i;
            }
            return result;
        }

        function evaluateExpression(expression) {
            // Determine conversion factor based on angle mode
            const toRadians = angleMode === 'deg' ? ' * Math.PI / 180' : '';
            const fromRadians = angleMode === 'deg' ? ' * 180 / Math.PI' : '';
            
            // Replace functions in specific order to avoid conflicts
            // Start with longer function names first
            
            // Inverse trigonometric functions (convert result from radians)
            expression = expression.replace(/asin\(/g, '__TEMP_ASIN__(');
            expression = expression.replace(/acos\(/g, '__TEMP_ACOS__(');
            expression = expression.replace(/atan\(/g, '__TEMP_ATAN__(');
            
            // Reciprocal functions
            expression = expression.replace(/cosec\(/g, '__TEMP_COSEC__(');
            expression = expression.replace(/csc\(/g, '__TEMP_CSC__(');
            expression = expression.replace(/sec\(/g, '__TEMP_SEC__(');
            expression = expression.replace(/cot\(/g, '__TEMP_COT__(');
            
            // Regular trigonometric functions (convert input to radians)
            expression = expression.replace(/sin\(/g, '__TEMP_SIN__(');
            expression = expression.replace(/cos\(/g, '__TEMP_COS__(');
            expression = expression.replace(/tan\(/g, '__TEMP_TAN__(');
            
            // Other functions
            expression = expression.replace(/log\(/g, '__TEMP_LOG__(');
            
            // Now replace with actual Math functions
            // Inverse functions
            expression = expression.replace(/__TEMP_ASIN__\(([^)]+)\)/g, (match, contents) => {
                return `(Math.asin(${contents})${fromRadians})`;
            });
            
            expression = expression.replace(/__TEMP_ACOS__\(([^)]+)\)/g, (match, contents) => {
                return `(Math.acos(${contents})${fromRadians})`;
            });
            
            expression = expression.replace(/__TEMP_ATAN__\(([^)]+)\)/g, (match, contents) => {
                return `(Math.atan(${contents})${fromRadians})`;
            });
            
            // Regular functions
            expression = expression.replace(/__TEMP_SIN__\(([^)]+)\)/g, (match, contents) => {
                return `Math.sin((${contents})${toRadians})`;
            });
            
            expression = expression.replace(/__TEMP_COS__\(([^)]+)\)/g, (match, contents) => {
                return `Math.cos((${contents})${toRadians})`;
            });
            
            expression = expression.replace(/__TEMP_TAN__\(([^)]+)\)/g, (match, contents) => {
                return `Math.tan((${contents})${toRadians})`;
            });
            
            // Reciprocal functions
            expression = expression.replace(/__TEMP_SEC__\(([^)]+)\)/g, (match, contents) => {
                return `(1 / Math.cos((${contents})${toRadians}))`;
            });
            
            expression = expression.replace(/__TEMP_COSEC__\(([^)]+)\)/g, (match, contents) => {
                return `(1 / Math.sin((${contents})${toRadians}))`;
            });
            
            expression = expression.replace(/__TEMP_CSC__\(([^)]+)\)/g, (match, contents) => {
                return `(1 / Math.sin((${contents})${toRadians}))`;
            });
            
            expression = expression.replace(/__TEMP_COT__\(([^)]+)\)/g, (match, contents) => {
                return `(1 / Math.tan((${contents})${toRadians}))`;
            });
            
            // Logarithm
            expression = expression.replace(/__TEMP_LOG__\(([^)]+)\)/g, (match, contents) => {
                return `Math.log10(${contents})`;
            });
            
            // Handle square root
            expression = expression.replace(/\(([^)]+)\)/g, (match, contents) => {
                return `Math.sqrt(${contents})`;
            });
            
            expression = expression.replace(/(\d+\.?\d*)/g, (match, number) => {
                return `Math.sqrt(${number})`;
            });
            
            // Handle factorial
            expression = expression.replace(/(\d+\.?\d*)!/g, (match, number) => {
                const num = parseFloat(number);
                if (num !== Math.floor(num) || num < 0) {
                    throw new Error('Factorial only works with non-negative integers');
                }
                return calculateFactorial(num).toString();
            });
            
            return expression;
        }

        function calculateResult(context = '') {
            const inputId = context ? `calculatorInput-${context}` : 'calculatorInput';
            const input = document.getElementById(inputId);
            if (!input) return;
            
            try {
                let expression = input.value;
                
                // Auto-close trigonometric functions if they're missing closing brackets
                expression = expression.replace(/(sin|cos|tan|asin|acos|atan|sec|csc|cot|log)\(([^)]*?)$/g, '$1($2)');
                
                const openParens = (expression.match(/\(/g) || []).length;
                const closeParens = (expression.match(/\)/g) || []).length;
                
                if (openParens !== closeParens) {
                    throw new Error('Unbalanced parentheses');
                }
                
                expression = evaluateExpression(expression);
                expression = expression.replace(//g, '*');
                expression = expression.replace(/\^/g, '**');
                
                if (/[+\-*\/\*\*]$/.test(expression)) {
                    throw new Error('Invalid expression');
                }
                
                // Enhanced validation pattern to include trigonometric functions
                const allowedPattern = /^[0-9+\-*\/\(\)\.\s]*$/;
                const cleanExpression = expression
                    .replace(/Math\.(sin|cos|tan|asin|acos|atan|sqrt|log10|PI)\(/g, '')
                    .replace(/Math\.(sin|cos|tan|asin|acos|atan|sqrt|log10|PI)/g, '')
                    .replace(/\(1 \/ Math\.(sin|cos|tan)\(/g, '')
                    .replace(/180/g, '')
                    .replace(/\)\)/g, '');
                
                if (!allowedPattern.test(cleanExpression)) {
                    throw new Error('Invalid characters in expression');
                }
                
                const result = new Function('return ' + expression)();
                
                if (result === Infinity) {
                    input.value = '';
                    return;
                } else if (result === -Infinity) {
                    input.value = '-';
                    return;
                } else if (isNaN(result)) {
                    throw new Error('Undefined result');
                } else if (!isFinite(result)) {
                    throw new Error('Invalid result');
                }
                
                const formattedResult = Number.isInteger(result) ? 
                    result.toString() : 
                    parseFloat(result.toFixed(10)).toString();
                
                input.value = formattedResult;
            } catch (error) {
                if (error.message === 'Undefined result') {
                    input.value = 'Undefined';
                    showNotification('Function undefined at this point! ', 'warning');
                } else if (error.message.includes('Factorial')) {
                    input.value = 'Error';
                    showNotification(error.message + ' ', 'warning');
                } else {
                    input.value = 'Error';
                    showNotification('Invalid expression! ', 'error');
                }
                setTimeout(() => {
                    input.value = '0';
                }, 2000);
            }
        }

        // Notepad Functions
        function saveNote(context = '') {
            const textareaId = context ? `notepadTextarea-${context}` : 'notepadText';
            const content = document.getElementById(textareaId)?.value;
            if (!content || !content.trim()) {
                showNotification('Nothing to save! ', 'warning');
                return;
            }
            
            const filename = prompt('Enter filename:', 'my-note');
            if (!filename) {
                showNotification('Save cancelled! ', 'info');
                return;
            }
            
            const timestamp = new Date().toISOString();
            const fileData = {
                content: content,
                filename: filename,
                timestamp: timestamp
            };
            
            const savedFiles = JSON.parse(localStorage.getItem('notepad_saved_files') || '[]');
            
            const existingIndex = savedFiles.findIndex(file => file.filename === filename);
            if (existingIndex !== -1) {
                if (!confirm(`File "${filename}" already exists. Overwrite?`)) {
                    showNotification('Save cancelled! ', 'info');
                    return;
                }
                savedFiles[existingIndex] = fileData;
            } else {
                savedFiles.push(fileData);
            }
            
            localStorage.setItem('notepad_saved_files', JSON.stringify(savedFiles));
            localStorage.setItem('notepad_content', content);
            
            showNotification(`File "${filename}" saved! `, 'success');
            updateSavedFilesList();
        }

        function clearNote(context = '') {
            if (confirm('Are you sure you want to clear all text?')) {
                const textareaId = context ? `notepadTextarea-${context}` : 'notepadText';
                const textarea = document.getElementById(textareaId);
                if (textarea) {
                    textarea.value = '';
                    localStorage.removeItem('notepad_content');
                    showNotification('Note cleared! ', 'info');
                }
            }
        }

        // Aliases for floating windows
        function clearNotepad(context) {
            clearNote(context);
        }

        function saveNotepadContent(context) {
            saveNote(context);
        }

        function downloadNote() {
            const content = document.getElementById('notepadText').value;
            if (!content.trim()) {
                showNotification('Nothing to download! ', 'warning');
                return;
            }
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'note.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            showNotification('Note downloaded! ', 'success');
        }

        function loadNotepadContent(context = '') {
            const textareaId = context ? `notepadTextarea-${context}` : 'notepadText';
            const savedContent = localStorage.getItem('notepad_content');
            const textarea = document.getElementById(textareaId);
            if (savedContent && textarea) {
                textarea.value = savedContent;
            }
            updateSavedFilesList();
        }

        function updateSavedFilesList() {
            const savedFiles = JSON.parse(localStorage.getItem('notepad_saved_files') || '[]');
            const filesList = document.getElementById('savedFilesList');
            
            if (!filesList) return;
            
            if (savedFiles.length === 0) {
                filesList.innerHTML = '<p class="no-files">No saved files</p>';
                return;
            }
            
            filesList.innerHTML = savedFiles.map((file, index) => `
                <div class="saved-file-item">
                    <div class="file-info">
                        <strong>${file.filename}</strong>
                        <small>${new Date(file.timestamp).toLocaleString()}</small>
                    </div>
                    <div class="file-actions">
                        <button class="btn btn-small" onclick="loadFile('${file.filename.replace(/'/g, "\\'")}')"> Load</button>
                        <button class="btn btn-small" onclick="downloadFile('${file.filename.replace(/'/g, "\\'")}')"> Download</button>
                        <button class="btn btn-small" onclick="deleteFile('${file.filename.replace(/'/g, "\\'")}')"> Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function loadFile(filename) {
            const savedFiles = JSON.parse(localStorage.getItem('notepad_saved_files') || '[]');
            const file = savedFiles.find(f => f.filename === filename);
            
            if (file) {
                document.getElementById('notepadText').value = file.content;
                localStorage.setItem('notepad_content', file.content);
                showNotification(`File "${filename}" loaded! `, 'success');
            } else {
                showNotification('File not found! ', 'error');
            }
        }

        function downloadFile(filename) {
            const savedFiles = JSON.parse(localStorage.getItem('notepad_saved_files') || '[]');
            const file = savedFiles.find(f => f.filename === filename);
            
            if (file) {
                const blob = new Blob([file.content], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${filename}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                showNotification(`File "${filename}" downloaded! `, 'success');
            } else {
                showNotification('File not found! ', 'error');
            }
        }

        function deleteFile(filename) {
            if (!confirm(`Are you sure you want to delete "${filename}"?`)) {
                return;
            }
            
            const savedFiles = JSON.parse(localStorage.getItem('notepad_saved_files') || '[]');
            const filteredFiles = savedFiles.filter(f => f.filename !== filename);
            
            if (filteredFiles.length < savedFiles.length) {
                localStorage.setItem('notepad_saved_files', JSON.stringify(filteredFiles));
                showNotification(`File "${filename}" deleted! `, 'info');
                updateSavedFilesList();
            } else {
                showNotification('File not found! ', 'error');
            }
        }

        // Timer Functions
        function initializeTimer(context = '') {
            if (context) {
                // Basic initialization for floating timer
                return;
            }
            switchTimerTab('timer');
        }

        // Timer function stubs for floating windows
        function switchTimerMode(mode, context) {
            if (!context) return;
            const countdownTab = document.getElementById(`countdownTab-${context}`);
            const stopwatchTab = document.getElementById(`stopwatchTab-${context}`);
            const countdownTimer = document.getElementById(`countdownTimer-${context}`);
            const stopwatchTimer = document.getElementById(`stopwatchTimer-${context}`);
            
            if (mode === 'countdown') {
                countdownTab?.classList.add('active');
                stopwatchTab?.classList.remove('active');
                if (countdownTimer) countdownTimer.style.display = 'block';
                if (stopwatchTimer) stopwatchTimer.style.display = 'none';
            } else {
                countdownTab?.classList.remove('active');
                stopwatchTab?.classList.add('active');
                if (countdownTimer) countdownTimer.style.display = 'none';
                if (stopwatchTimer) stopwatchTimer.style.display = 'block';
            }
        }

        function startTimer(context = '') {
            if (context) {
                showNotification('Timer functionality coming soon in floating windows! ', 'info');
                return;
            }
            // Original timer functionality for homepage
            const startBtn = document.getElementById('startTimer');
            const resetBtn = document.getElementById('resetTimer');
            
            // Check current button state to determine action
            if (startBtn.textContent === 'Start') {
            const resetBtn = document.getElementById('resetTimer');
            
            // Check current button state to determine action
            if (startBtn.textContent === 'Start') {
                // Starting fresh timer
                const hours = parseInt(document.getElementById('timerHours').value) || 0;
                const minutes = parseInt(document.getElementById('timerMinutes').value) || 0;
                const seconds = parseInt(document.getElementById('timerSeconds').value) || 0;
                let totalSeconds = hours * 3600 + minutes * 60 + seconds;
                
                if (totalSeconds <= 0) {
                    showNotification('Please set a valid time! ', 'warning');
                    return;
                }
                
                timerRemainingSeconds = totalSeconds;
                timerPaused = false;
                startBtn.textContent = 'Pause';
                
                timerInterval = setInterval(() => {
                    const hrs = Math.floor(timerRemainingSeconds / 3600);
                    const mins = Math.floor((timerRemainingSeconds % 3600) / 60);
                    const secs = timerRemainingSeconds % 60;
                    document.getElementById('timerDisplay').textContent = 
                        `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    
                    if (timerRemainingSeconds <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        startBtn.textContent = 'Start';
                        timerPaused = false;
                        timerRemainingSeconds = 0;
                        showNotification('Timer finished! ', 'success');
                        playTimerSound();
                        return;
                    }
                    timerRemainingSeconds--;
                }, 1000);
                
            } else if (startBtn.textContent === 'Pause') {
                // Pausing the timer
                clearInterval(timerInterval);
                timerInterval = null;
                timerPaused = true;
                startBtn.textContent = 'Resume';
                showNotification('Timer paused! ', 'info');
                
            } else if (startBtn.textContent === 'Resume') {
                // Resuming the timer
                timerPaused = false;
                startBtn.textContent = 'Pause';
                
                timerInterval = setInterval(() => {
                    const hrs = Math.floor(timerRemainingSeconds / 3600);
                    const mins = Math.floor((timerRemainingSeconds % 3600) / 60);
                    const secs = timerRemainingSeconds % 60;
                    document.getElementById('timerDisplay').textContent = 
                        `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    
                    if (timerRemainingSeconds <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        startBtn.textContent = 'Start';
                        timerPaused = false;
                        timerRemainingSeconds = 0;
                        showNotification('Timer finished! ', 'success');
                        playTimerSound();
                        return;
                    }
                    timerRemainingSeconds--;
                }, 1000);
            }
        }

        function resetTimer(context = '') {
            if (context) {
                showNotification('Timer reset functionality coming soon! ', 'info');
                return;
            }
            // Original reset functionality
            clearInterval(timerInterval);
            timerInterval = null;
            timerPaused = false;
            timerRemainingSeconds = 0;
            const startBtn = document.getElementById('startTimer');
            startBtn.textContent = 'Start';
            document.getElementById('timerDisplay').textContent = '00:05:00';
            document.getElementById('timerHours').value = 0;
            document.getElementById('timerMinutes').value = 5;
            document.getElementById('timerSeconds').value = 0;
        }

        // Timer function stubs for floating windows
        function pauseTimer(context) {
            if (context) {
                showNotification('Timer pause functionality coming soon! ', 'info');
            }
        }

        function pauseStopwatch(context) {
            if (context) {
                showNotification('Stopwatch pause functionality coming soon! ', 'info');
            }
        }

        function resetStopwatch(context) {
            if (context) {
                showNotification('Stopwatch reset functionality coming soon! ', 'info');
            }
        }

        function addLap(context) {
            if (context) {
                showNotification('Lap functionality coming soon! ', 'info');
            }
        }

        function startStopwatch(context = '') {
            if (context) {
                showNotification('Stopwatch functionality coming soon! ', 'info');
                return;
            }
            // Original stopwatch functionality
            const startBtn = document.getElementById('startStopwatch');
            
            if (startBtn.textContent === 'Start') {
                startBtn.textContent = 'Stop';
                stopwatchInterval = setInterval(() => {
                    stopwatchTime++;
                    updateStopwatchDisplay();
                }, 10);
            } else {
                startBtn.textContent = 'Start';
                clearInterval(stopwatchInterval);
            }
        }

        function lapStopwatch() {
            if (stopwatchInterval) {
                const lapTime = formatStopwatchTime(stopwatchTime);
                const lapDiv = document.createElement('div');
                lapDiv.className = 'lap-time';
                lapDiv.innerHTML = `<span>Lap ${lapCounter}</span><span>${lapTime}</span>`;
                document.getElementById('lapTimes').appendChild(lapDiv);
                lapCounter++;
            }
        }

        function resetStopwatch() {
            clearInterval(stopwatchInterval);
            stopwatchTime = 0;
            lapCounter = 1;
            document.getElementById('startStopwatch').textContent = 'Start';
            updateStopwatchDisplay();
            document.getElementById('lapTimes').innerHTML = '';
        }

        function updateStopwatchDisplay() {
            document.getElementById('stopwatchDisplay').textContent = formatStopwatchTime(stopwatchTime);
        }

        function formatStopwatchTime(time) {
            const minutes = Math.floor(time / 6000);
            const seconds = Math.floor((time % 6000) / 100);
            const centiseconds = time % 100;
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}:${centiseconds.toString().padStart(2, '0')}`;
        }

        function playTimerSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (error) {
                console.log('Could not play timer sound:', error);
            }
        }

        // Auto-save notepad content as user types
        document.addEventListener('DOMContentLoaded', function() {
            const notepadText = document.getElementById('notepadText');
            if (notepadText) {
                notepadText.addEventListener('input', function() {
                    localStorage.setItem('notepad_content', this.value);
                });
            }
        });

        // Keyboard shortcuts for calculator
        document.addEventListener('keydown', function(e) {
            const calculatorTool = document.getElementById('calculatorTool');
            const searchInput = document.getElementById('search-input');
            
            // Don't interfere with search input when it's focused
            if (document.activeElement === searchInput) {
                return;
            }
            
            // Only handle calculator shortcuts when calculator is visible
            if (!calculatorTool || calculatorTool.style.display === 'none') {
                return;
            }

            const key = e.key.toLowerCase();
            
            // Handle letter sequences for function names
            if (/[a-z]/.test(key) && key.length === 1) {
                e.preventDefault();
                
                keySequence += key;
                
                // Show typing indicator
                const input = document.getElementById('calculatorInput');
                const currentValue = input.value;
                
                // Clear previous sequence timeout
                clearTimeout(sequenceTimeout);
                
                // Set new timeout to clear sequence after 2 seconds
                sequenceTimeout = setTimeout(() => {
                    keySequence = '';
                }, 2000);
                
                // Check for complete function names and trigger immediately
                if (keySequence.endsWith('asin')) {
                    appendTrigFunction('asin');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                } else if (keySequence.endsWith('acos')) {
                    appendTrigFunction('acos');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                } else if (keySequence.endsWith('atan')) {
                    appendTrigFunction('atan');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                } else if (keySequence.endsWith('sin') && !keySequence.includes('asin') && !keySequence.includes('cosing')) {
                    appendTrigFunction('sin');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                } else if (keySequence.endsWith('cos') && !keySequence.includes('acos')) {
                    appendTrigFunction('cos');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                } else if (keySequence.endsWith('tan') && !keySequence.includes('atan')) {
                    appendTrigFunction('tan');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                } else if (keySequence.endsWith('sec')) {
                    appendTrigFunction('sec');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                } else if (keySequence.endsWith('csc') || keySequence.endsWith('cosec')) {
                    appendTrigFunction('csc');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                } else if (keySequence.endsWith('cot')) {
                    appendTrigFunction('cot');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                } else if (keySequence.endsWith('log')) {
                    appendToCalculator('log(');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                } else if (keySequence.endsWith('sqrt')) {
                    appendToCalculator('');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                } else if (keySequence.endsWith('pow')) {
                    appendToCalculator('^');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                } else if (keySequence.endsWith('fact') || keySequence.endsWith('factorial')) {
                    appendToCalculator('!');
                    keySequence = '';
                    clearTimeout(sequenceTimeout);
                    return;
                }
                
                console.log('Current sequence:', keySequence); // Debug log
                return; // Don't process other actions while building sequence
            }
            
            // Clear sequence for non-letter keys
            keySequence = '';
            clearTimeout(sequenceTimeout);
            
            // Handle individual keys and special combinations
            if (/[0-9+\-*/.()^!=]/.test(e.key) || e.key === 'Enter' || e.key === 'Backspace' || e.key === 'Delete' || e.key === 'Escape' || e.key === 'c' || e.key === 'C') {
                e.preventDefault();
                
                if (/[0-9+\-/.()^!=]/.test(e.key)) {
                    if (e.key === '*') {
                        appendToCalculator('');
                    } else {
                        appendToCalculator(e.key);
                    }
                } else if (e.key === 'Enter') {
                    calculateResult();
                } else if (e.key === 'Backspace') {
                    deleteLastCalculator();
                } else if (e.key === 'Delete' || e.key === 'Escape' || e.key === 'c' || e.key === 'C') {
                    clearCalculator();
                }
            }
            
            // Handle 'd' key for degree/radian toggle when not building a sequence
            if (e.key === 'd' && keySequence === '') {
                e.preventDefault();
                toggleAngleMode();
            }
        });

        // Engineering Graphics & Diagonal Scales Functions
        function initializeSimulations() {
            showNotification('Engineering Graphics & Drafting Simulation loaded! ', 'success');
            // Initialize the canvas
            setTimeout(() => {
                drawDiagonalScale();
            }, 500);
        }

        // Simulation Navigation Functions
        function openSimulation(simulationType) {
            const simulationsGrid = document.querySelector('.simulations-grid');
            const engineeringGraphics = document.getElementById('engineeringGraphicsSimulation');
            
            if (simulationType === 'engineering-graphics') {
                simulationsGrid.style.display = 'none';
                engineeringGraphics.style.display = 'block';
            } else {
                // For other simulations, show "Coming Soon" message
                alert(`${simulationType.charAt(0).toUpperCase() + simulationType.slice(1)} simulation is coming soon! \n\nFor now, try the Engineering Graphics simulation to learn about diagonal scales.`);
            }
        }

        function showSimulationsList() {
            const simulationsGrid = document.querySelector('.simulations-grid');
            const engineeringGraphics = document.getElementById('engineeringGraphicsSimulation');
            
            simulationsGrid.style.display = 'grid';
            engineeringGraphics.style.display = 'none';
            
            // Reset the canvas if it exists
            const canvas = document.getElementById('scaleCanvas');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            
            // Reset measurement display
            const measurementDisplay = document.getElementById('measurementDisplay');
            if (measurementDisplay) {
                measurementDisplay.innerHTML = 'Click "Generate Scale" to begin the interactive tutorial';
            }
        }

        // Diagonal Scale Functions
        function drawDiagonalScale() {
            const canvas = document.getElementById('scaleCanvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Get parameters
            const maxValue = parseInt(document.getElementById('maxValue').value) || 100;
            const majorDivisions = parseInt(document.getElementById('majorDivisions').value) || 10;
            const minorDivisions = parseInt(document.getElementById('minorDivisions').value) || 10;
            const scaleLengthCm = parseInt(document.getElementById('scaleLength').value) || 15;
            const targetValue = parseFloat(document.getElementById('targetValue').value) || 23.7;
            const scaleType = document.getElementById('scaleType').value;
            const showConstruction = document.getElementById('showConstruction').checked;
            
            // Convert cm to pixels (assuming 1cm = 30px for display)
            const scaleLength = scaleLengthCm * 30;
            const startX = 50;
            const startY = 100;
            
            // Calculate divisions
            const majorDivLength = scaleLength / majorDivisions;
            const minorDivLength = majorDivLength / minorDivisions;
            
            // Draw main scale line
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(startX + scaleLength, startY);
            ctx.stroke();
            
            // Draw major divisions
            ctx.lineWidth = 2;
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            
            for (let i = 0; i <= majorDivisions; i++) {
                const x = startX + (i * majorDivLength);
                
                // Major division line
                ctx.beginPath();
                ctx.moveTo(x, startY - 15);
                ctx.lineTo(x, startY + 15);
                ctx.stroke();
                
                // Major division label
                const value = (maxValue / majorDivisions) * i;
                ctx.fillText(value.toString(), x - 10, startY + 35);
            }
            
            if (scaleType === 'diagonal') {
                // Draw diagonal scale
                const diagonalHeight = 60;
                
                // Draw horizontal lines for minor divisions
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 1;
                
                for (let i = 0; i <= minorDivisions; i++) {
                    const y = startY + (i * diagonalHeight / minorDivisions);
                    ctx.beginPath();
                    ctx.moveTo(startX, y);
                    ctx.lineTo(startX + majorDivLength, y);
                    ctx.stroke();
                }
                
                // Draw diagonal lines
                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 1;
                
                for (let i = 0; i < majorDivisions; i++) {
                    const x1 = startX + (i * majorDivLength);
                    const x2 = startX + ((i + 1) * majorDivLength);
                    
                    for (let j = 1; j <= minorDivisions; j++) {
                        ctx.beginPath();
                        ctx.moveTo(x1, startY + (j * diagonalHeight / minorDivisions));
                        ctx.lineTo(x2, startY + ((j - 1) * diagonalHeight / minorDivisions));
                        ctx.stroke();
                    }
                }
                
                // Draw measurement demonstration
                if (targetValue <= maxValue) {
                    const units = Math.floor(targetValue / (maxValue / majorDivisions));
                    const remainder = targetValue % (maxValue / majorDivisions);
                    const tenths = Math.floor(remainder * minorDivisions / (maxValue / majorDivisions));
                    const hundredths = ((remainder * minorDivisions) % (maxValue / majorDivisions)) / (maxValue / majorDivisions);
                    
                    // Highlight the measurement
                    ctx.strokeStyle = '#2ecc71';
                    ctx.lineWidth = 3;
                    
                    const measureX = startX + (units * majorDivLength) + (tenths * majorDivLength / minorDivisions);
                    const measureY = startY + (tenths * diagonalHeight / minorDivisions) + 
                                    (hundredths * (diagonalHeight / minorDivisions));
                    
                    // Draw measurement point
                    ctx.beginPath();
                    ctx.arc(measureX, measureY, 5, 0, 2 * Math.PI);
                    ctx.fillStyle = '#2ecc71';
                    ctx.fill();
                    
                    // Draw measurement lines
                    ctx.beginPath();
                    ctx.moveTo(measureX, measureY);
                    ctx.lineTo(measureX, startY - 20);
                    ctx.stroke();
                    
                    // Show measurement value
                    ctx.fillStyle = '#2ecc71';
                    ctx.font = 'bold 14px Arial';
                    ctx.fillText(`${targetValue}`, measureX - 15, startY - 25);
                }
                
                // Add labels for diagonal scale
                ctx.fillStyle = '#333';
                ctx.font = '10px Arial';
                for (let i = 0; i <= minorDivisions; i++) {
                    const y = startY + (i * diagonalHeight / minorDivisions);
                    ctx.fillText(i.toString(), startX - 20, y + 3);
                }
            }
            
            // Add title and instructions
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Arial';
            ctx.fillText(`${scaleType === 'diagonal' ? 'Diagonal' : 'Plain'} Scale - Max: ${maxValue}, Target: ${targetValue}`, startX, 30);
            
            if (showConstruction) {
                ctx.font = '12px Arial';
                ctx.fillStyle = '#666';
                ctx.fillText('Red lines: Diagonal divisions for precise measurements', startX, canvas.height - 60);
                ctx.fillText('Green dot: Target measurement location', startX, canvas.height - 40);
                ctx.fillText('Scale: 1 major division = ' + (maxValue/majorDivisions), startX, canvas.height - 20);
            }
            
            // Update measurement display
            updateMeasurementDisplay(targetValue, maxValue, majorDivisions, minorDivisions);
        }
        
        function updateMeasurementDisplay(targetValue, maxValue, majorDivisions, minorDivisions) {
            const display = document.getElementById('measurementDisplay');
            
            if (targetValue > maxValue) {
                display.innerHTML = ` Target value (${targetValue}) exceeds scale maximum (${maxValue})`;
                display.style.background = 'rgba(231, 76, 60, 0.2)';
                return;
            }
            
            const unitValue = maxValue / majorDivisions;
            const units = Math.floor(targetValue / unitValue);
            const remainder = targetValue % unitValue;
            const tenths = Math.floor(remainder * minorDivisions / unitValue);
            const hundredths = Math.round(((remainder * minorDivisions) % unitValue) / unitValue * 10);
            
            display.innerHTML = `
                 <strong>Reading: ${targetValue}</strong><br>
                 Breakdown: ${units} units + ${tenths}.${hundredths} subdivisions<br>
                 Position: Major div ${units}, Minor div ${tenths}, Diagonal ${hundredths}
            `;
            display.style.background = 'rgba(79, 70, 229, 0.2)';
        }
        
        function startTutorial() {
            document.getElementById('maxValue').value = 50;
            document.getElementById('majorDivisions').value = 5;
            document.getElementById('minorDivisions').value = 10;
            document.getElementById('targetValue').value = 12.3;
            document.getElementById('scaleType').value = 'diagonal';
            document.getElementById('showConstruction').checked = true;
            drawDiagonalScale();
            showNotification(' Tutorial started! Study the construction carefully.', 'info');
        }
        
        function practiceMode() {
            const randomTarget = Math.round(Math.random() * 45 + 5);
            document.getElementById('targetValue').value = randomTarget + Math.random().toFixed(1);
            drawDiagonalScale();
            showNotification(' Practice mode! Try to read the highlighted measurement.', 'info');
        }
        
        function showExample() {
            document.getElementById('maxValue').value = 100;
            document.getElementById('majorDivisions').value = 10;
            document.getElementById('minorDivisions').value = 10;
            document.getElementById('targetValue').value = 37.6;
            document.getElementById('scaleType').value = 'diagonal';
            document.getElementById('showConstruction').checked = true;
            drawDiagonalScale();
            showNotification(' Example: How to read 37.6 on a diagonal scale', 'success');
        }
        
        function resetScale() {
            document.getElementById('maxValue').value = 100;
            document.getElementById('majorDivisions').value = 10;
            document.getElementById('minorDivisions').value = 10;
            document.getElementById('scaleLength').value = 15;
            document.getElementById('targetValue').value = 23.7;
            document.getElementById('scaleType').value = 'diagonal';
            document.getElementById('showConstruction').checked = true;
            drawDiagonalScale();
            showNotification(' Scale reset to default values', 'info');
        }

        // Lectures Functions
        function initializeLectures() {
            showNotification('Educational Lectures loaded! ', 'success');
        }

        // Lecture Management Functions
        let userLectures = JSON.parse(localStorage.getItem('userLectures')) || [];

        async function addLecture() {
            const title = document.getElementById('lectureTitle').value.trim();
            const url = document.getElementById('lectureURL').value.trim();

            // Validation
            if (!title || !url) {
                showNotification('Please fill in both title and YouTube URL! ', 'error');
                return;
            }

            // Validate YouTube URL
            if (!isYouTubeURL(url)) {
                showNotification('Please enter a valid YouTube URL! ', 'error');
                return;
            }

            // Show loading notification
            showNotification('Fetching video details from YouTube... ', 'info');

            try {
                const videoDetails = await fetchYouTubeDetails(url);
                
                const lecture = {
                    id: Date.now().toString(),
                    title: videoDetails.title || title,
                    subject: 'YouTube',
                    url,
                    duration: videoDetails.duration || 'Unknown',
                    level: 'General',
                    instructor: videoDetails.channelName || 'YouTube',
                    description: videoDetails.description || 'Added from YouTube',
                    dateAdded: new Date().toISOString(),
                    thumbnail: videoDetails.thumbnail || getVideoThumbnail(url),
                    viewCount: videoDetails.viewCount || 'N/A',
                    uploadDate: videoDetails.uploadDate || 'Unknown'
                };

                userLectures.push(lecture);
                saveLectures();
                displayLectures();
                clearLectureForm();

                showNotification(`Lecture "${lecture.title}" added successfully! `, 'success');
            } catch (error) {
                console.error('Error fetching YouTube details:', error);
                
                // Fallback to basic lecture creation
                const lecture = {
                    id: Date.now().toString(),
                    title,
                    subject: 'YouTube',
                    url,
                    duration: 'Unknown',
                    level: 'General',
                    instructor: 'YouTube',
                    description: 'Added from YouTube',
                    dateAdded: new Date().toISOString(),
                    thumbnail: getVideoThumbnail(url),
                    viewCount: 'N/A',
                    uploadDate: 'Unknown'
                };

                userLectures.push(lecture);
                saveLectures();
                displayLectures();
                clearLectureForm();

                showNotification(`Lecture "${title}" added (some details unavailable) `, 'success');
            }
        }

        function clearLectureForm() {
            document.getElementById('lectureTitle').value = '';
            document.getElementById('lectureURL').value = '';
        }

        function saveLectures() {
            localStorage.setItem('userLectures', JSON.stringify(userLectures));
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) return 'yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
            if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;
            return `${Math.floor(diffDays / 365)} years ago`;
        }

        function displayLectures(lecturesToShow = userLectures) {
            const grid = document.getElementById('lecturesGrid');
            
            if (lecturesToShow.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"></div>
                        <h4>No lectures found</h4>
                        <p>${userLectures.length === 0 ? 'Add your first lecture using the form above to get started!' : 'Try adjusting your search or filter criteria.'}</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = lecturesToShow.map(lecture => `
                <div class="youtube-video-card" onclick="playLecture('${lecture.id}')">
                    <div class="video-thumbnail-container">
                        <img src="${lecture.thumbnail}" alt="${lecture.title}" class="video-thumbnail" loading="lazy">
                        <div class="play-overlay">
                            <div class="play-button"></div>
                        </div>
                        <button class="delete-btn-thumbnail" onclick="event.stopPropagation(); deleteLecture('${lecture.id}')" title="Delete lecture">
                            
                        </button>
                        ${lecture.duration !== 'Unknown' ? `<div class="duration-badge">${lecture.duration}</div>` : ''}
                    </div>
                    <div class="video-info">
                        <div class="video-title" title="${lecture.title}">${lecture.title}</div>
                        <div class="channel-name">${lecture.instructor}</div>
                        <div class="video-meta">
                            <span class="upload-date">Added ${formatDate(lecture.dateAdded)}</span>
                            ${lecture.viewCount !== 'N/A' ? `<span class="view-count">${lecture.viewCount} views</span>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function deleteLecture(lectureId) {
            const lecture = userLectures.find(l => l.id === lectureId);
            if (lecture && confirm(`Are you sure you want to delete "${lecture.title}"?`)) {
                userLectures = userLectures.filter(l => l.id !== lectureId);
                saveLectures();
                displayLectures();
                showNotification('Lecture deleted successfully! ', 'success');
            }
        }

        function playLecture(lectureId) {
            const lecture = userLectures.find(l => l.id === lectureId);
            if (!lecture) return;

            const modal = document.getElementById('videoPlayerModal');
            const titleElement = document.getElementById('modalLectureTitle');
            const containerElement = document.getElementById('videoPlayerContainer');
            const detailsElement = document.getElementById('modalLectureDetails');

            titleElement.textContent = lecture.title;
            
            // Create video player based on URL type
            const videoHTML = createVideoPlayer(lecture.url);
            containerElement.innerHTML = videoHTML;

            detailsElement.innerHTML = `
                <p><strong>Channel:</strong> ${lecture.instructor}</p>
                <p><strong>Duration:</strong> ${lecture.duration}</p>
                <p><strong>Added:</strong> ${formatDate(lecture.dateAdded)}</p>
                ${lecture.viewCount !== 'N/A' ? `<p><strong>Views:</strong> ${lecture.viewCount}</p>` : ''}
                <p><strong>URL:</strong> <a href="${lecture.url}" target="_blank" rel="noopener noreferrer">${lecture.url}</a></p>
            `;

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeVideoPlayer() {
            const modal = document.getElementById('videoPlayerModal');
            const container = document.getElementById('videoPlayerContainer');
            
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
            container.innerHTML = ''; // Stop video playback
        }

        function searchLectures() {
            const searchTerm = document.getElementById('lectureSearch').value.toLowerCase();
            
            let filtered = userLectures;
            
            if (searchTerm) {
                filtered = filtered.filter(lecture => 
                    lecture.title.toLowerCase().includes(searchTerm) ||
                    lecture.instructor.toLowerCase().includes(searchTerm)
                );
            }
            
            displayLectures(filtered);
        }



        // Utility Functions
        function isValidURL(string) {
            try {
                const url = new URL(string);
                return url.protocol === 'http:' || url.protocol === 'https:';
            } catch (_) {
                return false;
            }
        }

        function isYouTubeURL(url) {
            return url.includes('youtube.com/watch') || url.includes('youtu.be/') || url.includes('youtube.com/embed/');
        }

        async function fetchYouTubeDetails(url) {
            const videoId = extractYouTubeId(url);
            if (!videoId) {
                throw new Error('Invalid YouTube URL');
            }

            try {
                // Try to get video details using oEmbed API (basic info)
                const oEmbedUrl = `https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`;
                const response = await fetch(oEmbedUrl);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch video details');
                }

                const data = await response.json();
                
                // Extract channel name from author_name
                const channelName = data.author_name || 'Unknown Channel';
                
                // Create thumbnail URL (high quality)
                const thumbnail = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
                
                return {
                    title: data.title || 'Unknown Title',
                    channelName: channelName,
                    thumbnail: thumbnail,
                    description: `Video by ${channelName}`,
                    duration: 'Unknown', // oEmbed doesn't provide duration
                    viewCount: 'N/A',
                    uploadDate: 'Unknown'
                };
            } catch (error) {
                console.error('Error fetching YouTube details:', error);
                
                // Fallback to basic details
                return {
                    title: 'Unknown Title',
                    channelName: 'Unknown Channel',
                    thumbnail: `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`,
                    description: 'Added from YouTube',
                    duration: 'Unknown',
                    viewCount: 'N/A',
                    uploadDate: 'Unknown'
                };
            }
        }

        function getSubjectIcon(subject) {
            const icons = {
                'Mathematics': '',
                'Physics': '',
                'Chemistry': '',
                'Biology': '',
                'Computer Science': '',
                'History': '',
                'Literature': '',
                'Economics': '',
                'Psychology': '',
                'Engineering': '',
                'Art': '',
                'Music': ''
            };
            return icons[subject] || '';
        }

        function getVideoThumbnail(url) {
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                const videoId = extractYouTubeId(url);
                return videoId ? `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg` : null;
            }
            return null;
        }

        function extractYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        function createVideoPlayer(url) {
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                const videoId = extractYouTubeId(url);
                if (videoId) {
                    return `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1" allowfullscreen></iframe>`;
                }
            } else if (url.includes('vimeo.com')) {
                const vimeoId = url.split('/').pop();
                return `<iframe src="https://player.vimeo.com/video/${vimeoId}?autoplay=1" allowfullscreen></iframe>`;
            } else {
                return `<video controls autoplay style="width: 100%; height: 100%;"><source src="${url}" type="video/mp4">Your browser does not support the video tag.</video>`;
            }
            
            return `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #f1f5f9;">
                <p>Unable to play this video format. <a href="${url}" target="_blank" style="color: #3b82f6;">Open in new tab</a></p>
            </div>`;
        }

        // Initialize lectures on page load
        function initializeLectures() {
            displayLectures();
        }

        // Add event listener for modal close on background click and ESC key
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('videoPlayerModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeVideoPlayer();
                    }
                });
            }
            
            // Close modal with ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal && modal.style.display === 'flex') {
                    closeVideoPlayer();
                }
            });
        });

        // Study Material Functions
        function initializeStudyMaterial() {
            showNotification('Study Materials loaded! ', 'success');
        }

        function downloadMaterial(materialId) {
            const materials = {
                'math-pyqs': 'Mathematics Previous Year Questions (2019-2024)',
                'physics-pyqs': 'Physics Previous Year Questions (2018-2024)',
                'chemistry-pyqs': 'Chemistry Previous Year Questions (2019-2024)',
                'programming-assignments': 'Programming Assignments - Data Structures & Algorithms',
                'statistics-assignments': 'Statistics Assignments - Probability & Regression',
                'lab-assignments': 'Laboratory Assignments - Physics & Chemistry'
            };
            
            const materialName = materials[materialId];
            showNotification(`Downloading: ${materialName} `, 'info');
            
            // Simulate download process
            setTimeout(() => {
                showNotification(`Download complete: ${materialName} `, 'success');
            }, 1500);
        }

        function viewMaterial(materialId) {
            const materials = {
                'math-pyqs': 'Mathematics Previous Year Questions (2019-2024)',
                'physics-pyqs': 'Physics Previous Year Questions (2018-2024)',
                'chemistry-pyqs': 'Chemistry Previous Year Questions (2019-2024)',
                'programming-assignments': 'Programming Assignments - Data Structures & Algorithms',
                'statistics-assignments': 'Statistics Assignments - Probability & Regression',
                'lab-assignments': 'Laboratory Assignments - Physics & Chemistry'
            };
            
            const materialName = materials[materialId];
            showNotification(`Opening preview: ${materialName} `, 'info');
            
            // Simulate preview loading
            setTimeout(() => {
                showNotification(`Preview ready: ${materialName} `, 'success');
            }, 1000);
        }

        // Search functionality
        const searchContainer = document.querySelector('.search-container');
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('searchResults');

        // Search data - all tools, simulations, and lectures
        const searchData = [
            { name: 'Calculator', type: 'tool', description: 'Advanced calculator with trigonometric functions' },
            { name: 'Timer', type: 'tool', description: 'Study timer with hours, minutes, and seconds' },
            { name: 'Notepad', type: 'tool', description: 'Take notes with file management' },
            { name: 'Study Simulations', type: 'section', description: 'Engineering Graphics & Drafting simulation' },
            { name: 'Lectures', type: 'section', description: 'Educational video lectures and courses' },
            { name: 'Study Material', type: 'section', description: 'PYQs, assignments, and study resources' },
            { name: 'Engineering Graphics', type: 'simulation', description: 'Interactive diagonal scales and drafting tutorial' },
            { name: 'Diagonal Scales', type: 'simulation', description: 'Learn to construct and use diagonal scales for precise measurements' },
            { name: 'Drafting Tools', type: 'simulation', description: 'Engineering drawing tools and measurement techniques' },
            { name: 'Scale Reading', type: 'simulation', description: 'Practice reading measurements from diagonal scales' },
            { name: 'Introduction to Programming', type: 'lecture', description: 'Learn the basics of programming languages' },
            { name: 'Data Structures & Algorithms', type: 'lecture', description: 'Master data structures and algorithmic thinking' },
            { name: 'Calculus Fundamentals', type: 'lecture', description: 'Comprehensive calculus course from basics to advanced' },
            { name: 'Physics: Mechanics', type: 'lecture', description: 'Classical mechanics and motion principles' },
            { name: 'Chemistry: Organic Compounds', type: 'lecture', description: 'Study organic chemistry and molecular structures' },
            { name: 'History of Science', type: 'lecture', description: 'Explore the evolution of scientific thought' },
            { name: 'Mathematics PYQs', type: 'material', description: 'Previous year questions for mathematics (2019-2024)' },
            { name: 'Physics PYQs', type: 'material', description: 'Previous year questions for physics (2018-2024)' },
            { name: 'Chemistry PYQs', type: 'material', description: 'Previous year questions for chemistry (2019-2024)' },
            { name: 'Programming Assignments', type: 'material', description: 'Data structures and algorithms assignments' },
            { name: 'Statistics Assignments', type: 'material', description: 'Probability and regression analysis assignments' },
            { name: 'Lab Assignments', type: 'material', description: 'Physics and chemistry laboratory experiments' }
        ];

        // Show search results
        function showSearchResults(results) {
            // Clear previous results first
            searchResults.innerHTML = '';
            
            if (results.length === 0) {
                searchResults.innerHTML = '<div class="search-result-item no-results">No results found</div>';
            } else {
                searchResults.innerHTML = results.map(item => `
                    <div class="search-result-item" onclick="navigateToItem('${item.type}', '${item.name}')">
                        <div class="search-result-title">${highlightMatch(item.name, searchInput.value)}</div>
                        <div class="search-result-description">${item.description}</div>
                        <div class="search-result-type">${item.type}</div>
                    </div>
                `).join('');
            }
            
            // Show results with smooth transition
            searchResults.style.display = 'block';
            searchResults.style.opacity = '1';
        }

        // Highlight matching text in search results
        function highlightMatch(text, query) {
            if (!query || query.trim() === '') return text;
            
            const regex = new RegExp(`(${query.trim()})`, 'gi');
            return text.replace(regex, '<mark style="background: rgba(79, 70, 229, 0.3); color: #f1f5f9; padding: 0.1rem 0.2rem; border-radius: 0.2rem;">$1</mark>');
        }

        // Hide search results
        function hideSearchResults() {
            searchResults.style.opacity = '0';
            setTimeout(() => {
                searchResults.style.display = 'none';
                searchResults.innerHTML = '';
            }, 150); // Small delay for smooth transition
        }

        // Navigate to search result
        function navigateToItem(type, name) {
            hideSearchResults();
            searchInput.value = '';
            // Don't hide the search container - keep it visible

            switch (type) {
                case 'tool':
                    if (name === 'Calculator') showTool('calculator');
                    else if (name === 'Timer') showTool('timer');
                    else if (name === 'Notepad') showTool('notepad');
                    break;
                case 'section':
                    if (name === 'Study Simulations') showTool('simulations');
                    else if (name === 'Lectures') showTool('lectures');
                    else if (name === 'Study Material') showTool('study-material');
                    break;
                case 'simulation':
                case 'lecture':
                case 'material':
                    // For simulations and lectures, show the parent section
                    if (type === 'simulation') showTool('simulations');
                    else if (type === 'lecture') showTool('lectures');
                    else if (type === 'material') showTool('study-material');
                    break;
            }
        }

        // Search input event listener
        searchInput.addEventListener('input', function() {
            console.log('Search input detected:', this.value); // Debug log
            const query = this.value.toLowerCase().trim();
            
            // Get all tool cards
            const toolCards = document.querySelectorAll('.tool-card');
            
            if (query === '') {
                // Show all tool cards and hide search results dropdown
                hideSearchResults();
                toolCards.forEach(card => {
                    card.style.display = 'block';
                    // Reset any highlighted text
                    resetCardHighlight(card);
                });
                return;
            }

            // Hide the dropdown search results since we're filtering cards directly
            hideSearchResults();
            
            let hasVisibleCards = false;

            // Filter tool cards based on search query
            toolCards.forEach(card => {
                const cardTitle = card.querySelector('h3').textContent.toLowerCase();
                const cardDescription = card.querySelector('p').textContent.toLowerCase();
                
                if (cardTitle.includes(query) || cardDescription.includes(query)) {
                    // Show matching card and highlight text
                    card.style.display = 'block';
                    highlightCardText(card, query);
                    hasVisibleCards = true;
                } else {
                    // Hide non-matching card
                    card.style.display = 'none';
                }
            });

            // If no cards match, show a "no results" message in the main area
            if (!hasVisibleCards) {
                showNoResultsMessage();
            } else {
                hideNoResultsMessage();
            }
        });

        // Function to highlight matching text in tool cards
        function highlightCardText(card, query) {
            const title = card.querySelector('h3');
            const description = card.querySelector('p');
            
            // Store original text if not already stored
            if (!title.dataset.originalText) {
                title.dataset.originalText = title.textContent;
            }
            if (!description.dataset.originalText) {
                description.dataset.originalText = description.textContent;
            }
            
            // Highlight matching text
            const regex = new RegExp(`(${query})`, 'gi');
            title.innerHTML = title.dataset.originalText.replace(regex, '<mark style="background: rgba(79, 70, 229, 0.4); color: #f1f5f9; padding: 0.1rem 0.2rem; border-radius: 0.2rem;">$1</mark>');
            description.innerHTML = description.dataset.originalText.replace(regex, '<mark style="background: rgba(79, 70, 229, 0.4); color: #f1f5f9; padding: 0.1rem 0.2rem; border-radius: 0.2rem;">$1</mark>');
        }

        // Function to reset card highlighting
        function resetCardHighlight(card) {
            const title = card.querySelector('h3');
            const description = card.querySelector('p');
            
            if (title.dataset.originalText) {
                title.innerHTML = title.dataset.originalText;
            }
            if (description.dataset.originalText) {
                description.innerHTML = description.dataset.originalText;
            }
        }

        // Function to show "no results" message
        function showNoResultsMessage() {
            let noResultsDiv = document.getElementById('noResultsMessage');
            if (!noResultsDiv) {
                noResultsDiv = document.createElement('div');
                noResultsDiv.id = 'noResultsMessage';
                noResultsDiv.style.cssText = `
                    text-align: center;
                    padding: 3rem;
                    color: rgba(241, 245, 249, 0.6);
                    font-size: 1.2rem;
                    grid-column: 1 / -1;
                `;
                noResultsDiv.innerHTML = ' No tools found matching your search';
                document.getElementById('toolsGrid').appendChild(noResultsDiv);
            }
            noResultsDiv.style.display = 'block';
        }

        // Function to hide "no results" message
        function hideNoResultsMessage() {
            const noResultsDiv = document.getElementById('noResultsMessage');
            if (noResultsDiv) {
                noResultsDiv.style.display = 'none';
            }
        }

        // Ensure search input can receive focus when clicked
        searchInput.addEventListener('click', function() {
            this.focus();
        });

        // Show search results when search input gets focus and has content
        searchInput.addEventListener('focus', function() {
            console.log('Search input focused'); // Debug log
            const query = this.value.toLowerCase().trim();
            if (query !== '') {
                // Trigger the input event to refresh the card filtering
                this.dispatchEvent(new Event('input'));
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            const searchInput = document.getElementById('search-input');
            
            // Ctrl+K to focus search (only if search input is not already focused)
            if (e.ctrlKey && e.key === 'k') {
                e.preventDefault();
                searchInput.focus();
                return;
            }
            
            // Escape to clear search and reset cards (only if search input is focused)
            if (e.key === 'Escape' && document.activeElement === searchInput) {
                searchInput.value = '';
                // Reset all cards to visible
                const toolCards = document.querySelectorAll('.tool-card');
                toolCards.forEach(card => {
                    card.style.display = 'block';
                    resetCardHighlight(card);
                });
                hideNoResultsMessage();
                searchInput.blur(); // Remove focus from search input
                return;
            }
        });

        // Close search results when clicking outside (no longer needed for dropdown, but keep for consistency)
        document.addEventListener('click', function(e) {
            if (!searchContainer.contains(e.target)) {
                hideSearchResults();
            }
        });

        // Prevent search container from closing when clicking inside it
        searchContainer.addEventListener('click', function(e) {
            e.stopPropagation();
        });

        // AI Chatbot Functions
        let chatHistory = [];
        let isProcessing = false;

        // Gemini API Configuration
        // To get your API key:
        // 1. Go to https://makersuite.google.com/app/apikey
        // 2. Sign in with your Google account
        // 3. Create a new API key
        // 4. Replace 'YOUR_GEMINI_API_KEY_HERE' below with your actual API key
        // 5. Keep your API key secure and never share it publicly
        const GEMINI_API_KEY = 'AIzaSyBRdwjXVqAdmOfuNhUtqeZB4UFFSDfiLlg'; // Replace with your actual API key
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';

        function sendMessage(context = '') {
            const inputId = context ? `chatInput-${context}` : 'chatInput';
            const input = document.getElementById(inputId);
            const message = input?.value.trim();
            
            if (!message || isProcessing) return;
            
            // Add user message
            addMessage(message, 'user', context);
            input.value = '';
            
            // Process the message
            processUserMessage(message, context);
        }

        function formatAIResponse(text) {
            // Handle various markdown-like formatting
            let formatted = text;
            
            // Convert **bold** to <strong>bold</strong>
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Convert *italic* to <em>italic</em>
            formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Convert code blocks ```code``` to <code>code</code>
            formatted = formatted.replace(/```(.*?)```/gs, '<code class="code-block">$1</code>');
            
            // Convert inline code `code` to <code>code</code>
            formatted = formatted.replace(/`(.*?)`/g, '<code class="inline-code">$1</code>');
            
            // Convert numbered lists (1. item)
            formatted = formatted.replace(/^\d+\.\s(.+)$/gm, '<li class="numbered-list">$1</li>');
            
            // Convert bullet points (- item or  item)
            formatted = formatted.replace(/^[-]\s(.+)$/gm, '<li class="bullet-list">$1</li>');
            
            // Wrap consecutive list items in appropriate list tags
            formatted = formatted.replace(/(<li class="numbered-list">.*?<\/li>(\s*<li class="numbered-list">.*?<\/li>)*)/gs, '<ol class="formatted-list">$1</ol>');
            formatted = formatted.replace(/(<li class="bullet-list">.*?<\/li>(\s*<li class="bullet-list">.*?<\/li>)*)/gs, '<ul class="formatted-list">$1</ul>');
            
            // Clean up list class names after wrapping
            formatted = formatted.replace(/class="numbered-list"/g, '');
            formatted = formatted.replace(/class="bullet-list"/g, '');
            
            // Convert line breaks to <br> tags
            formatted = formatted.replace(/\n/g, '<br>');
            
            // Convert ### Headers to <h3>
            formatted = formatted.replace(/^### (.+)$/gm, '<h3 class="response-header">$1</h3>');
            
            // Convert ## Headers to <h2>
            formatted = formatted.replace(/^## (.+)$/gm, '<h2 class="response-header">$1</h2>');
            
            // Convert # Headers to <h1>
            formatted = formatted.replace(/^# (.+)$/gm, '<h1 class="response-header">$1</h1>');
            
            return formatted;
        }

        function addMessage(text, type, context = '') {
            const messagesId = context ? `chatMessages-${context}` : 'chatMessages';
            const messagesContainer = document.getElementById(messagesId);
            if (!messagesContainer) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            
            const avatar = type === 'user' ? '' : '';
            const currentTime = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            // Format AI responses but keep user messages as plain text
            const formattedText = type === 'assistant' ? formatAIResponse(text) : text;
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <div class="message-text">${formattedText}</div>
                    <div class="message-time">${currentTime}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Store in chat history
            chatHistory.push({ text, type, timestamp: new Date() });
        }

        function showTypingIndicator(context = '') {
            const messagesId = context ? `chatMessages-${context}` : 'chatMessages';
            const messagesContainer = document.getElementById(messagesId);
            if (!messagesContainer) return;
            
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message assistant-message typing-indicator-message';
            typingDiv.innerHTML = `
                <div class="message-avatar"></div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <span>AI is thinking</span>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator(context = '') {
            const messagesId = context ? `chatMessages-${context}` : 'chatMessages';
            const messagesContainer = document.getElementById(messagesId);
            if (!messagesContainer) return;
            
            const typingIndicator = messagesContainer.querySelector('.typing-indicator-message');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function processUserMessage(message, context = '') {
            if (isProcessing) return;
            
            isProcessing = true;
            const sendButtonId = context ? `sendButton-${context}` : 'sendButton';
            const sendButton = document.getElementById(sendButtonId) || document.querySelector(`#${context ? 'floating' : 'ai-chatbot'} .send-button`);
            if (sendButton) sendButton.disabled = true;
            
            showTypingIndicator(context);
            
            try {
                // Check if API key is configured
                if (GEMINI_API_KEY === 'YOUR_GEMINI_API_KEY_HERE') {
                    hideTypingIndicator(context);
                    const fallbackResponse = generateAIResponse(message);
                    addMessage(fallbackResponse + '\n\n Note: Using fallback responses. Please add your Gemini API key for full AI capabilities.', 'assistant', context);
                    return;
                }

                // Prepare the request payload for Gemini API
                const requestBody = {
                    contents: [
                        {
                            parts: [
                                {
                                    text: `You are a helpful AI study assistant. The user is asking: "${message}". Please provide a clear, educational response that helps with their study question. Focus on being educational and supportive.`
                                }
                            ]
                        }
                    ],
                    generationConfig: {
                        temperature: 0.7,
                        topP: 0.8,
                        topK: 10,
                        maxOutputTokens: 2048,
                    }
                };

                // Make API call to Gemini
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();
                
                hideTypingIndicator(context);
                
                // Extract the response text from Gemini API response
                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts[0]) {
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    addMessage(aiResponse, 'assistant', context);
                } else {
                    throw new Error('Invalid response format from API');
                }
                
            } catch (error) {
                hideTypingIndicator(context);
                console.error('Gemini API error:', error);
                
                // Fallback to local responses if API fails
                const fallbackResponse = generateAIResponse(message);
                addMessage(fallbackResponse + '\n\n Note: AI API temporarily unavailable, using fallback response.', 'assistant', context);
            } finally {
                isProcessing = false;
                if (sendButton) sendButton.disabled = false;
            }
        }

        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Study-related responses
            if (lowerMessage.includes('math') || lowerMessage.includes('mathematics') || lowerMessage.includes('calculus') || lowerMessage.includes('algebra')) {
                return "I'd be happy to help with mathematics! Could you be more specific about the topic or problem you're working on? Whether it's calculus, algebra, geometry, or statistics, I can provide explanations, examples, and step-by-step solutions.";
            }
            
            if (lowerMessage.includes('physics') || lowerMessage.includes('mechanics') || lowerMessage.includes('thermodynamics')) {
                return "Physics can be challenging but fascinating! What specific area are you studying? I can help explain concepts in mechanics, thermodynamics, electromagnetism, optics, or modern physics with clear examples and practical applications.";
            }
            
            if (lowerMessage.includes('chemistry') || lowerMessage.includes('organic') || lowerMessage.includes('inorganic')) {
                return "Chemistry involves understanding how matter behaves at the molecular level. What topic are you working on? I can help with organic chemistry, inorganic chemistry, physical chemistry, or general chemistry concepts.";
            }
            
            if (lowerMessage.includes('biology') || lowerMessage.includes('anatomy') || lowerMessage.includes('cell')) {
                return "Biology is the study of life! Are you looking at cell biology, anatomy, genetics, ecology, or another area? I can explain biological processes, structures, and systems in an easy-to-understand way.";
            }
            
            if (lowerMessage.includes('computer') || lowerMessage.includes('programming') || lowerMessage.includes('coding')) {
                return "Computer science and programming are exciting fields! What language or concept are you learning? I can help with algorithms, data structures, programming languages, or computer science theory.";
            }
            
            if (lowerMessage.includes('english') || lowerMessage.includes('literature') || lowerMessage.includes('writing')) {
                return "I can assist with English language and literature! Whether you need help with grammar, essay writing, literary analysis, or reading comprehension, I'm here to guide you through it.";
            }
            
            if (lowerMessage.includes('history') || lowerMessage.includes('historical')) {
                return "History helps us understand the past and present! What time period or region are you studying? I can provide context, explain historical events, and help you understand their significance.";
            }
            
            // General study help
            if (lowerMessage.includes('study') || lowerMessage.includes('learn') || lowerMessage.includes('understand')) {
                return "Great that you're focused on learning! What subject or topic would you like to study? I can help break down complex concepts, suggest study strategies, and provide explanations tailored to your learning style.";
            }
            
            if (lowerMessage.includes('exam') || lowerMessage.includes('test') || lowerMessage.includes('preparation')) {
                return "Exam preparation is crucial for success! What subject is your exam on? I can help you review key concepts, suggest study schedules, and provide practice questions to boost your confidence.";
            }
            
            if (lowerMessage.includes('homework') || lowerMessage.includes('assignment')) {
                return "I'd be happy to help with your homework! Please share the specific question or topic you're working on, and I'll guide you through the solution step by step.";
            }
            
            // Encouraging responses for vague questions
            if (lowerMessage.includes('help') || lowerMessage.includes('doubt') || lowerMessage.includes('question')) {
                return "I'm here to help with your studies! Please feel free to ask specific questions about any subject - mathematics, science, literature, history, or any other topic you're learning. The more details you provide, the better I can assist you!";
            }
            
            // Default response
            return "That's an interesting question! Could you provide more details about what you'd like to learn or understand? I'm here to help with any academic subject or study-related topic you're working on. Feel free to ask about specific concepts, problems, or areas where you need clarification!";
        }

        function insertQuickPrompt(prompt) {
            const input = document.getElementById('chatInput');
            input.value = prompt;
            input.focus();
        }

        function clearChat() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = `
                <div class="message assistant-message">
                    <div class="message-avatar"></div>
                    <div class="message-content">
                        <div class="message-text">
                            Hello! I'm your AI Study Assistant. I'm here to help you with any study doubts, explanations, or academic questions you might have. Just type your question below and I'll do my best to help! 
                        </div>
                        <div class="message-time">Just now</div>
                    </div>
                </div>
            `;
            chatHistory = [];
        }

        // Handle Enter key for chat input
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }
            
            // Load materials when page loads
            loadMaterials();
        });

        // Material Management Functions
        let materials = [];

        function loadMaterials() {
            const saved = localStorage.getItem('studyMaterials');
            if (saved) {
                materials = JSON.parse(saved);
            }
            displayMaterials();
            updateStats();
        }

        function saveMaterials() {
            localStorage.setItem('studyMaterials', JSON.stringify(materials));
            updateStats();
        }

        function addMaterial() {
            const title = document.getElementById('materialTitle').value.trim();
            const category = document.getElementById('materialCategory').value;
            const link = document.getElementById('materialLink').value.trim();
            const description = document.getElementById('materialDescription').value.trim();

            // Validation
            if (!title) {
                alert('Please enter a title for the material.');
                return;
            }

            if (!link) {
                alert('Please enter a Google Drive link.');
                return;
            }

            // Validate Google Drive link
            if (!isValidGoogleDriveLink(link)) {
                alert('Please enter a valid Google Drive link.');
                return;
            }

            const material = {
                id: Date.now(),
                title: title,
                category: category,
                link: link,
                description: description,
                dateAdded: new Date().toISOString()
            };

            materials.push(material);
            saveMaterials();
            displayMaterials();
            clearForm();
            
            // Show success message
            showNotification('Material added successfully! ', 'success');
        }

        function isValidGoogleDriveLink(url) {
            const drivePatterns = [
                /^https:\/\/drive\.google\.com\/file\/d\/[a-zA-Z0-9_-]+/,
                /^https:\/\/docs\.google\.com\/[a-zA-Z]+\/d\/[a-zA-Z0-9_-]+/,
                /^https:\/\/drive\.google\.com\/open\?id=[a-zA-Z0-9_-]+/
            ];
            return drivePatterns.some(pattern => pattern.test(url));
        }

        function clearForm() {
            document.getElementById('materialTitle').value = '';
            document.getElementById('materialCategory').value = 'pyq';
            document.getElementById('materialLink').value = '';
            document.getElementById('materialDescription').value = '';
        }

        function displayMaterials(filter = 'all') {
            const grid = document.getElementById('materialsGrid');
            const emptyState = document.getElementById('emptyState');
            
            let filteredMaterials = materials;
            if (filter !== 'all') {
                filteredMaterials = materials.filter(material => material.category === filter);
            }

            if (filteredMaterials.length === 0) {
                if (filter === 'all' && materials.length === 0) {
                    emptyState.style.display = 'block';
                    grid.innerHTML = '';
                    grid.appendChild(emptyState);
                } else {
                    grid.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon"></div>
                            <h4>No materials found</h4>
                            <p>No materials found in this category.</p>
                        </div>
                    `;
                }
                return;
            }

            emptyState.style.display = 'none';
            
            grid.innerHTML = filteredMaterials.map(material => {
                const categoryEmojis = {
                    pyq: '',
                    assignment: '',
                    notes: '',
                    lab: '',
                    other: ''
                };
                
                const categoryNames = {
                    pyq: 'PYQ',
                    assignment: 'Assignment',
                    notes: 'Notes',
                    lab: 'Lab Manual',
                    other: 'Other'
                };

                return `
                    <div class="material-card" data-category="${material.category}">
                        <div class="material-card-header">
                            <div class="material-info">
                                <h4>${material.title}</h4>
                                <div class="material-category-badge">
                                    ${categoryEmojis[material.category]} ${categoryNames[material.category]}
                                </div>
                            </div>
                        </div>
                        ${material.description ? `<div class="material-description">${material.description}</div>` : ''}
                        <div class="material-actions">
                            <button class="btn btn-primary" onclick="openMaterial('${material.link}')">
                                 Open Link
                            </button>
                            <button class="btn btn-secondary" onclick="copyLink('${material.link}')">
                                 Copy Link
                            </button>
                            <button class="btn btn-danger" onclick="deleteMaterial(${material.id})">
                                
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterMaterials(category) {
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            
            displayMaterials(category);
        }

        function openMaterial(link) {
            window.open(link, '_blank');
        }

        function copyLink(link) {
            navigator.clipboard.writeText(link).then(() => {
                showNotification('Link copied to clipboard! ', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = link;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('Link copied to clipboard! ', 'success');
            });
        }

        function deleteMaterial(id) {
            if (confirm('Are you sure you want to delete this material?')) {
                materials = materials.filter(material => material.id !== id);
                saveMaterials();
                displayMaterials();
                showNotification('Material deleted successfully! ', 'success');
            }
        }

        function updateStats() {
            document.getElementById('totalMaterials').textContent = materials.length;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'linear-gradient(135deg, #10b981, #059669)' : 'linear-gradient(135deg, #06b6d4, #0891b2)'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 0.5rem;
                z-index: 10000;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
                transform: translateX(400px);
                transition: transform 0.3s ease;
                font-weight: 600;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Fun Learning Functions
        let flashcards = [];
        let currentFlashcardIndex = 0;
        let isFlashcardFlipped = false;
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let quizAnswers = [];
        let quizStartTime = null;
        let funStats = {
            totalFlashcards: 0,
            studySessions: 0,
            totalQuizzes: 0,
            quizScores: [],
            recentActivity: []
        };

        function initializeFunLearning() {
            loadFlashcards();
            loadFunStats();
            showFunSection('flashcards');
            updateFlashcardStats();
            updateQuizStats();
            updateStatsDisplay();
        }

        function showFunSection(section) {
            // Update navigation
            document.querySelectorAll('.fun-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-section="${section}"]`).classList.add('active');

            // Show section
            document.querySelectorAll('.fun-section').forEach(sec => {
                sec.classList.remove('active');
            });
            document.getElementById(section + 'Section').classList.add('active');

            if (section === 'stats') {
                updateStatsDisplay();
            }
        }

        // Flashcard Functions
        function loadFlashcards() {
            const saved = localStorage.getItem('funFlashcards');
            if (saved) {
                flashcards = JSON.parse(saved);
            }
            updateFlashcardDisplay();
            updateCategoryFilter();
            updateFlashcardList();
        }

        function saveFlashcards() {
            localStorage.setItem('funFlashcards', JSON.stringify(flashcards));
            updateFlashcardStats();
        }

        function showAddFlashcardForm() {
            document.getElementById('addFlashcardForm').style.display = 'block';
            document.getElementById('flashcardQuestion').focus();
        }

        function hideAddFlashcardForm() {
            document.getElementById('addFlashcardForm').style.display = 'none';
            clearFlashcardForm();
        }

        function clearFlashcardForm() {
            document.getElementById('flashcardQuestion').value = '';
            document.getElementById('flashcardAnswer').value = '';
            document.getElementById('flashcardCategory').value = '';
        }

        function addFlashcard() {
            const question = document.getElementById('flashcardQuestion').value.trim();
            const answer = document.getElementById('flashcardAnswer').value.trim();
            const category = document.getElementById('flashcardCategory').value.trim() || 'General';

            if (!question || !answer) {
                alert('Please fill in both question and answer fields.');
                return;
            }

            const flashcard = {
                id: Date.now(),
                question: question,
                answer: answer,
                category: category,
                dateCreated: new Date().toISOString(),
                timesStudied: 0
            };

            flashcards.push(flashcard);
            saveFlashcards();
            updateFlashcardDisplay();
            updateCategoryFilter();
            updateFlashcardList();
            hideAddFlashcardForm();
            
            addActivity('Created flashcard', category);
            showNotification('Flashcard added successfully! ', 'success');
        }

        function updateFlashcardDisplay() {
            const container = document.getElementById('flashcardContainer');
            const navigation = document.getElementById('flashcardNavigation');
            const counter = document.getElementById('flashcardCounter');

            const filter = document.getElementById('categoryFilter').value;
            const filteredCards = filter === 'all' ? flashcards : flashcards.filter(card => card.category === filter);

            if (filteredCards.length === 0) {
                container.innerHTML = `
                    <div class="empty-flashcards">
                        <div class="empty-icon"></div>
                        <h4>No flashcards available</h4>
                        <p>${filter === 'all' ? 'Create your first flashcard to start studying!' : 'No flashcards found in this category.'}</p>
                    </div>
                `;
                navigation.style.display = 'none';
                counter.textContent = '0 / 0';
                return;
            }

            if (currentFlashcardIndex >= filteredCards.length) {
                currentFlashcardIndex = 0;
            }

            const card = filteredCards[currentFlashcardIndex];
            isFlashcardFlipped = false;

            container.innerHTML = `
                <div class="flashcard" onclick="flipFlashcard()">
                    <div class="flashcard-type">Question</div>
                    <div class="flashcard-content">${card.question}</div>
                </div>
            `;

            navigation.style.display = 'flex';
            counter.textContent = `${currentFlashcardIndex + 1} / ${filteredCards.length}`;
        }

        function flipFlashcard() {
            const flashcard = document.querySelector('.flashcard');
            const content = document.querySelector('.flashcard-content');
            const type = document.querySelector('.flashcard-type');

            const filter = document.getElementById('categoryFilter').value;
            const filteredCards = filter === 'all' ? flashcards : flashcards.filter(card => card.category === filter);
            const card = filteredCards[currentFlashcardIndex];

            if (!isFlashcardFlipped) {
                flashcard.classList.add('flipped');
                content.textContent = card.answer;
                type.textContent = 'Answer';
                isFlashcardFlipped = true;
                
                // Increment study count
                card.timesStudied++;
                saveFlashcards();
            } else {
                flashcard.classList.remove('flipped');
                content.textContent = card.question;
                type.textContent = 'Question';
                isFlashcardFlipped = false;
            }
        }

        function nextFlashcard() {
            const filter = document.getElementById('categoryFilter').value;
            const filteredCards = filter === 'all' ? flashcards : flashcards.filter(card => card.category === filter);
            
            currentFlashcardIndex = (currentFlashcardIndex + 1) % filteredCards.length;
            updateFlashcardDisplay();
        }

        function previousFlashcard() {
            const filter = document.getElementById('categoryFilter').value;
            const filteredCards = filter === 'all' ? flashcards : flashcards.filter(card => card.category === filter);
            
            currentFlashcardIndex = currentFlashcardIndex === 0 ? filteredCards.length - 1 : currentFlashcardIndex - 1;
            updateFlashcardDisplay();
        }

        function shuffleFlashcards() {
            const filter = document.getElementById('categoryFilter').value;
            if (filter === 'all') {
                flashcards = flashcards.sort(() => Math.random() - 0.5);
            }
            currentFlashcardIndex = 0;
            updateFlashcardDisplay();
            showNotification('Flashcards shuffled! ', 'success');
        }

        function resetStudyMode() {
            currentFlashcardIndex = 0;
            updateFlashcardDisplay();
            addActivity('Started study session', 'Flashcards');
            funStats.studySessions++;
            saveFunStats();
        }

        function filterFlashcards() {
            currentFlashcardIndex = 0;
            updateFlashcardDisplay();
        }

        function updateCategoryFilter() {
            const filter = document.getElementById('categoryFilter');
            const categories = [...new Set(flashcards.map(card => card.category))];
            
            const currentValue = filter.value;
            filter.innerHTML = '<option value="all">All Categories</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                filter.appendChild(option);
            });
            
            filter.value = currentValue;
        }

        function updateFlashcardList() {
            const list = document.getElementById('flashcardList');
            if (flashcards.length === 0) {
                list.innerHTML = '<p style="color: rgba(241, 245, 249, 0.6); text-align: center;">No flashcards created yet.</p>';
                return;
            }

            list.innerHTML = flashcards.map(card => `
                <div class="flashcard-item">
                    <div class="flashcard-item-info">
                        <h5>${card.question.length > 50 ? card.question.substring(0, 50) + '...' : card.question}</h5>
                        <p>${card.category}  Studied ${card.timesStudied} times</p>
                    </div>
                    <div class="flashcard-item-actions">
                        <button class="btn btn-secondary btn-sm" onclick="editFlashcard(${card.id})"> Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteFlashcard(${card.id})"> Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteFlashcard(id) {
            if (confirm('Are you sure you want to delete this flashcard?')) {
                flashcards = flashcards.filter(card => card.id !== id);
                saveFlashcards();
                updateFlashcardDisplay();
                updateCategoryFilter();
                updateFlashcardList();
                showNotification('Flashcard deleted! ', 'success');
            }
        }

        function editFlashcard(id) {
            const card = flashcards.find(c => c.id === id);
            if (card) {
                document.getElementById('flashcardQuestion').value = card.question;
                document.getElementById('flashcardAnswer').value = card.answer;
                document.getElementById('flashcardCategory').value = card.category;
                
                // Remove the old card and show form
                deleteFlashcard(id);
                showAddFlashcardForm();
            }
        }

        // AI Quiz Functions
        async function generateQuiz() {
            const topic = document.getElementById('quizTopic').value.trim();
            const difficulty = document.getElementById('quizDifficulty').value;
            const numQuestions = parseInt(document.getElementById('quizQuestions').value);

            if (!topic) {
                alert('Please enter a topic for the quiz.');
                return;
            }

            const generateBtn = document.getElementById('generateQuizBtn');
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = '<span class="btn-icon"></span><span class="btn-text">Generating...</span>';
            generateBtn.classList.add('loading');
            generateBtn.disabled = true;

            try {
                const prompt = `Generate ${numQuestions} multiple choice questions about "${topic}" at ${difficulty} difficulty level. 
                
                Format your response as a JSON array with this exact structure:
                [
                  {
                    "question": "Question text here",
                    "options": ["Option A", "Option B", "Option C", "Option D"],
                    "correct": 0
                  }
                ]
                
                Rules:
                - Each question should have exactly 4 options
                - The "correct" field should be the index (0-3) of the correct answer
                - Make questions educational and relevant to the topic
                - Vary the position of correct answers
                - Return only the JSON array, no other text`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const quizText = data.candidates[0].content.parts[0].text;
                
                // Extract JSON from response
                const jsonMatch = quizText.match(/\[[\s\S]*\]/);
                if (!jsonMatch) {
                    throw new Error('Invalid response format from AI');
                }

                const questions = JSON.parse(jsonMatch[0]);
                
                if (!Array.isArray(questions) || questions.length === 0) {
                    throw new Error('No questions generated');
                }

                currentQuiz = {
                    topic: topic,
                    difficulty: difficulty,
                    questions: questions,
                    totalQuestions: questions.length
                };

                startQuiz();
                addActivity('Generated AI quiz', topic);

            } catch (error) {
                console.error('Error generating quiz:', error);
                showNotification('Failed to generate quiz. Please try again! ', 'error');
            } finally {
                generateBtn.innerHTML = originalText;
                generateBtn.classList.remove('loading');
                generateBtn.disabled = false;
            }
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            quizAnswers = [];
            quizStartTime = Date.now();

            document.getElementById('quizGeneratorForm').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            document.getElementById('quizResults').style.display = 'none';

            document.getElementById('quizTitle').textContent = `${currentQuiz.topic} Quiz (${currentQuiz.difficulty})`;
            document.getElementById('totalQuestions').textContent = currentQuiz.totalQuestions;

            showQuestion();
        }

        function showQuestion() {
            const question = currentQuiz.questions[currentQuestionIndex];
            
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('questionOptions');
            optionsContainer.innerHTML = question.options.map((option, index) => `
                <button class="option-btn" onclick="selectOption(${index})" data-option="${index}">
                    ${String.fromCharCode(65 + index)}. ${option}
                </button>
            `).join('');

            // Update progress
            const progress = ((currentQuestionIndex + 1) / currentQuiz.totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === currentQuiz.totalQuestions - 1) {
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('submitBtn').style.display = 'block';
            } else {
                document.getElementById('nextBtn').style.display = 'block';
                document.getElementById('submitBtn').style.display = 'none';
            }

            // Restore previous answer if any
            if (quizAnswers[currentQuestionIndex] !== undefined) {
                const selectedBtn = document.querySelector(`[data-option="${quizAnswers[currentQuestionIndex]}"]`);
                if (selectedBtn) {
                    selectedBtn.classList.add('selected');
                }
            }
        }

        function selectOption(optionIndex) {
            // Remove previous selection
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });

            // Add selection to clicked option
            document.querySelector(`[data-option="${optionIndex}"]`).classList.add('selected');
            
            // Store answer
            quizAnswers[currentQuestionIndex] = optionIndex;
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentQuiz.totalQuestions - 1) {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function submitQuiz() {
            const timeTaken = Date.now() - quizStartTime;
            let correctAnswers = 0;

            currentQuiz.questions.forEach((question, index) => {
                if (quizAnswers[index] === question.correct) {
                    correctAnswers++;
                }
            });

            const score = Math.round((correctAnswers / currentQuiz.totalQuestions) * 100);
            
            // Update stats
            funStats.totalQuizzes++;
            funStats.quizScores.push(score);
            addActivity('Completed quiz', `${score}% on ${currentQuiz.topic}`);
            saveFunStats();

            // Show results
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('quizResults').style.display = 'block';

            document.getElementById('finalScore').textContent = score + '%';
            document.getElementById('correctAnswers').textContent = correctAnswers;
            document.getElementById('totalQuestionsResult').textContent = currentQuiz.totalQuestions;
            
            const minutes = Math.floor(timeTaken / 60000);
            const seconds = Math.floor((timeTaken % 60000) / 1000);
            document.getElementById('timeTaken').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

            updateQuizStats();
        }

        function resetQuiz() {
            document.getElementById('quizGeneratorForm').style.display = 'block';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('quizResults').style.display = 'none';
            currentQuiz = null;
        }

        function reviewAnswers() {
            // This could be expanded to show detailed answer review
            alert('Answer review feature coming soon!');
        }

        // Statistics Functions
        function loadFunStats() {
            const saved = localStorage.getItem('funStats');
            if (saved) {
                funStats = { ...funStats, ...JSON.parse(saved) };
            }
        }

        function saveFunStats() {
            localStorage.setItem('funStats', JSON.stringify(funStats));
        }

        function updateFlashcardStats() {
            funStats.totalFlashcards = flashcards.length;
            saveFunStats();
        }

        function updateQuizStats() {
            document.getElementById('quizzesTaken').textContent = funStats.totalQuizzes;
            const bestScore = funStats.quizScores.length > 0 ? Math.max(...funStats.quizScores) : 0;
            document.getElementById('bestScore').textContent = bestScore + '%';
        }

        function updateStatsDisplay() {
            document.getElementById('totalFlashcards').textContent = funStats.totalFlashcards;
            document.getElementById('studySessions').textContent = funStats.studySessions;
            document.getElementById('totalQuizzes').textContent = funStats.totalQuizzes;
            
            const avgScore = funStats.quizScores.length > 0 
                ? Math.round(funStats.quizScores.reduce((a, b) => a + b, 0) / funStats.quizScores.length)
                : 0;
            document.getElementById('averageScore').textContent = avgScore + '%';

            // Update recent activity
            const activityContainer = document.getElementById('recentActivity');
            if (funStats.recentActivity.length === 0) {
                activityContainer.innerHTML = '<p style="color: rgba(241, 245, 249, 0.6); text-align: center;">No recent activity.</p>';
            } else {
                activityContainer.innerHTML = funStats.recentActivity.slice(0, 5).map(activity => `
                    <div class="activity-item">
                        <div class="activity-info">${activity.action} - ${activity.details}</div>
                        <div class="activity-time">${formatTime(activity.timestamp)}</div>
                    </div>
                `).join('');
            }
        }

        function addActivity(action, details) {
            funStats.recentActivity.unshift({
                action: action,
                details: details,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 10 activities
            if (funStats.recentActivity.length > 10) {
                funStats.recentActivity = funStats.recentActivity.slice(0, 10);
            }
            
            saveFunStats();
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (days > 0) return `${days}d ago`;
            if (hours > 0) return `${hours}h ago`;
            if (minutes > 0) return `${minutes}m ago`;
            return 'Just now';
        }

        // Floating Windows System
        let floatingWindows = new Map();
        let windowZIndex = 1000;
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let activeWindow = null;
        let windowBounds = { width: 0, height: 0 };
        let lastFrameTime = 0;

        function openFloatingWindow(toolType) {
            // Check if window already exists
            if (floatingWindows.has(toolType)) {
                const existingWindow = floatingWindows.get(toolType);
                bringWindowToFront(existingWindow);
                return;
            }

            const windowId = `floating-${toolType}-${Date.now()}`;
            const window = createFloatingWindow(windowId, toolType);
            
            floatingWindows.set(toolType, window);
            document.getElementById('floatingWindowsContainer').appendChild(window);
            
            // Position window with slight offset for multiple windows
            const offset = floatingWindows.size * 30;
            window.style.left = `${100 + offset}px`;
            window.style.top = `${100 + offset}px`;
            
            bringWindowToFront(window);
            initializeFloatingTool(toolType, window);
            
            showNotification(`${getToolTitle(toolType)} opened in floating window! `, 'success');
        }

        function createFloatingWindow(windowId, toolType) {
            const window = document.createElement('div');
            window.className = 'floating-window';
            window.id = windowId;
            window.setAttribute('data-tool-type', toolType);
            
            const toolIcon = getToolIcon(toolType);
            const toolTitle = getToolTitle(toolType);
            
            window.innerHTML = `
                <div class="window-header" onmousedown="startDrag(event, '${windowId}')">
                    <div class="window-title">
                        <span>${toolIcon}</span>
                        <span>${toolTitle}</span>
                    </div>
                    <div class="window-controls">
                        <button class="window-control-btn minimize-btn" onclick="minimizeWindow('${windowId}')" title="Minimize"></button>
                        <button class="window-control-btn maximize-btn" onclick="toggleMaximize('${windowId}')" title="Maximize"></button>
                        <button class="window-control-btn close-btn" onclick="closeFloatingWindow('${windowId}')" title="Close"></button>
                    </div>
                </div>
                <div class="window-content" id="${windowId}-content">
                    <div class="loading-message">Loading ${toolTitle}...</div>
                </div>
            `;
            
            return window;
        }

        function getToolIcon(toolType) {
            const icons = {
                'calculator': '',
                'notepad': '',
                'timer': '',
                'ai-chatbot': ''
            };
            return icons[toolType] || '';
        }

        function getToolTitle(toolType) {
            const titles = {
                'calculator': 'Calculator',
                'notepad': 'Notepad',
                'timer': 'Timer',
                'ai-chatbot': 'AI Assistant'
            };
            return titles[toolType] || 'Tool';
        }

        function initializeFloatingTool(toolType, window) {
            const content = window.querySelector('.window-content');
            
            switch(toolType) {
                case 'calculator':
                    content.innerHTML = createCalculatorContent();
                    initializeCalculator('floating');
                    break;
                case 'notepad':
                    content.innerHTML = createNotepadContent();
                    loadNotepadContent('floating');
                    break;
                case 'timer':
                    content.innerHTML = createTimerContent();
                    initializeTimer('floating');
                    break;
                case 'ai-chatbot':
                    content.innerHTML = createChatbotContent();
                    initializeChatbot('floating');
                    break;
            }
        }

        function createCalculatorContent() {
            return `
                <div class="calculator">
                    <div class="calculator-display">
                        <input type="text" id="calculatorInput-floating" readonly value="0">
                    </div>
                    <div class="calculator-mode">
                        <button class="mode-btn active" id="degreeMode-floating" onclick="toggleAngleMode('floating')">DEG</button>
                        <span class="mode-separator">|</span>
                        <button class="mode-btn" id="radianMode-floating" onclick="toggleAngleMode('floating')">RAD</button>
                    </div>
                    <div class="calculator-buttons">
                        <button class="calc-btn clear" onclick="clearCalculator('floating')">C</button>
                        <button class="calc-btn operator" onclick="appendToCalculator('(', 'floating')">(</button>
                        <button class="calc-btn operator" onclick="appendToCalculator(')', 'floating')">)</button>
                        <button class="calc-btn operator" onclick="deleteLastCalculator('floating')"></button>
                        
                        <button class="calc-btn operator" onclick="appendTrigFunction('sin', 'floating')">sin</button>
                        <button class="calc-btn operator" onclick="appendTrigFunction('cos', 'floating')">cos</button>
                        <button class="calc-btn operator" onclick="appendTrigFunction('tan', 'floating')">tan</button>
                        <button class="calc-btn operator" onclick="appendToCalculator('', 'floating')"></button>
                        
                        <button class="calc-btn number" onclick="appendToCalculator('7', 'floating')">7</button>
                        <button class="calc-btn number" onclick="appendToCalculator('8', 'floating')">8</button>
                        <button class="calc-btn number" onclick="appendToCalculator('9', 'floating')">9</button>
                        <button class="calc-btn operator" onclick="appendToCalculator('/', 'floating')">/</button>
                        
                        <button class="calc-btn number" onclick="appendToCalculator('4', 'floating')">4</button>
                        <button class="calc-btn number" onclick="appendToCalculator('5', 'floating')">5</button>
                        <button class="calc-btn number" onclick="appendToCalculator('6', 'floating')">6</button>
                        <button class="calc-btn operator" onclick="appendToCalculator('*', 'floating')"></button>
                        
                        <button class="calc-btn number" onclick="appendToCalculator('1', 'floating')">1</button>
                        <button class="calc-btn number" onclick="appendToCalculator('2', 'floating')">2</button>
                        <button class="calc-btn number" onclick="appendToCalculator('3', 'floating')">3</button>
                        <button class="calc-btn operator" onclick="appendToCalculator('-', 'floating')">-</button>
                        
                        <button class="calc-btn number" onclick="appendToCalculator('0', 'floating')">0</button>
                        <button class="calc-btn number" onclick="appendToCalculator('.', 'floating')">.</button>
                        <button class="calc-btn operator" onclick="appendToCalculator('+', 'floating')">+</button>
                        <button class="calc-btn equals" onclick="calculateResult('floating')" style="grid-row: span 2;">=</button>
                    </div>
                </div>
            `;
        }

        function createNotepadContent() {
            return `
                <div class="notepad">
                    <div class="notepad-toolbar">
                        <button class="btn btn-secondary" onclick="clearNotepad('floating')"> Clear</button>
                        <button class="btn btn-secondary" onclick="saveNotepadContent('floating')"> Save</button>
                        <span class="word-count" id="wordCount-floating">0 words</span>
                    </div>
                    <textarea id="notepadTextarea-floating" class="notepad-textarea" placeholder="Start typing your notes..."></textarea>
                </div>
            `;
        }

        function createTimerContent() {
            return `
                <div class="timer-container">
                    <div class="timer-tabs">
                        <button class="timer-tab active" onclick="switchTimerMode('countdown', 'floating')" id="countdownTab-floating"> Countdown</button>
                        <button class="timer-tab" onclick="switchTimerMode('stopwatch', 'floating')" id="stopwatchTab-floating"> Stopwatch</button>
                    </div>
                    
                    <div id="countdownTimer-floating" class="timer-mode active">
                        <div class="timer-display" id="timerDisplay-floating">00:05:00</div>
                        <div class="timer-inputs">
                            <input type="number" id="minutesInput-floating" min="0" max="59" value="5" placeholder="Min">
                            <span>:</span>
                            <input type="number" id="secondsInput-floating" min="0" max="59" value="0" placeholder="Sec">
                        </div>
                        <div class="timer-controls">
                            <button class="btn btn-primary" onclick="startTimer('floating')" id="startTimerBtn-floating"> Start</button>
                            <button class="btn btn-secondary" onclick="pauseTimer('floating')" id="pauseTimerBtn-floating"> Pause</button>
                            <button class="btn btn-outline" onclick="resetTimer('floating')" id="resetTimerBtn-floating"> Reset</button>
                        </div>
                    </div>
                    
                    <div id="stopwatchTimer-floating" class="timer-mode">
                        <div class="timer-display" id="stopwatchDisplay-floating">00:00:00</div>
                        <div class="timer-controls">
                            <button class="btn btn-primary" onclick="startStopwatch('floating')" id="startStopwatchBtn-floating"> Start</button>
                            <button class="btn btn-secondary" onclick="pauseStopwatch('floating')" id="pauseStopwatchBtn-floating"> Pause</button>
                            <button class="btn btn-outline" onclick="resetStopwatch('floating')" id="resetStopwatchBtn-floating"> Reset</button>
                            <button class="btn btn-secondary" onclick="addLap('floating')" id="lapBtn-floating"> Lap</button>
                        </div>
                        <div class="lap-times" id="lapTimes-floating"></div>
                    </div>
                </div>
            `;
        }

        function createChatbotContent() {
            return `
                <div class="chatbot-container-floating">
                    <div class="chat-messages" id="chatMessages-floating">
                        <div class="message assistant-message">
                            <div class="message-avatar"></div>
                            <div class="message-content">
                                <div class="message-text">
                                    Hello! I'm your AI Study Assistant. How can I help you today?
                                </div>
                                <div class="message-time">Just now</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <div class="chat-input-wrapper">
                            <input type="text" id="chatInput-floating" placeholder="Ask your question..." autocomplete="off">
                            <button class="send-button" onclick="sendMessage('floating')"></button>
                        </div>
                    </div>
                </div>
            `;
        }

        function bringWindowToFront(window) {
            windowZIndex++;
            window.style.zIndex = windowZIndex;
            
            // Update active window
            document.querySelectorAll('.floating-window').forEach(w => w.classList.remove('active'));
            window.classList.add('active');
            activeWindow = window;
        }

        function minimizeWindow(windowId) {
            const window = document.getElementById(windowId);
            window.classList.add('minimized');
            
            // Add to taskbar if not exists
            updateTaskbar();
        }

        function toggleMaximize(windowId) {
            const window = document.getElementById(windowId);
            window.classList.toggle('maximized');
            
            const button = window.querySelector('.maximize-btn');
            if (window.classList.contains('maximized')) {
                button.innerHTML = '';
                button.title = 'Restore';
            } else {
                button.innerHTML = '';
                button.title = 'Maximize';
            }
        }

        function closeFloatingWindow(windowId) {
            const window = document.getElementById(windowId);
            const toolType = window.getAttribute('data-tool-type');
            
            window.remove();
            floatingWindows.delete(toolType);
            updateTaskbar();
        }

        function updateTaskbar() {
            const minimizedWindows = document.querySelectorAll('.floating-window.minimized');
            let taskbar = document.querySelector('.floating-taskbar');
            
            if (minimizedWindows.length === 0) {
                if (taskbar) taskbar.remove();
                return;
            }
            
            if (!taskbar) {
                taskbar = document.createElement('div');
                taskbar.className = 'floating-taskbar';
                document.body.appendChild(taskbar);
            }
            
            taskbar.innerHTML = Array.from(minimizedWindows).map(window => {
                const toolType = window.getAttribute('data-tool-type');
                const icon = getToolIcon(toolType);
                const title = getToolTitle(toolType);
                
                return `
                    <div class="taskbar-item" onclick="restoreWindow('${window.id}')">
                        <span>${icon}</span>
                        <span>${title}</span>
                    </div>
                `;
            }).join('');
        }

        function restoreWindow(windowId) {
            const window = document.getElementById(windowId);
            window.classList.remove('minimized');
            bringWindowToFront(window);
            updateTaskbar();
        }

        // Drag functionality - Optimized for smooth performance
        function startDrag(event, windowId) {
            event.preventDefault();
            const window = document.getElementById(windowId);
            
            if (window.classList.contains('maximized')) return;
            
            isDragging = true;
            activeWindow = window;
            window.classList.add('window-dragging');
            
            // Store window bounds for performance (avoid repeated getBoundingClientRect calls)
            const rect = window.getBoundingClientRect();
            windowBounds.width = rect.width;
            windowBounds.height = rect.height;
            
            dragOffset.x = event.clientX - rect.left;
            dragOffset.y = event.clientY - rect.top;
            
            bringWindowToFront(window);
            
            // Use requestAnimationFrame for smoother performance
            document.addEventListener('mousemove', onMouseMove, { passive: true });
            document.addEventListener('mouseup', stopDrag);
            
            // Prevent text selection while dragging
            document.body.style.userSelect = 'none';
            document.body.style.cursor = 'grabbing';
        }

        let pendingDrag = null;
        
        function onMouseMove(event) {
            if (!isDragging || !activeWindow) return;
            
            // Cancel previous animation frame if it hasn't executed yet
            if (pendingDrag) {
                cancelAnimationFrame(pendingDrag);
            }
            
            // Schedule the drag update for the next frame
            pendingDrag = requestAnimationFrame(() => {
                updateWindowPosition(event.clientX, event.clientY);
                pendingDrag = null;
            });
        }

        function updateWindowPosition(clientX, clientY) {
            if (!activeWindow || !isDragging) return;
            
            const x = clientX - dragOffset.x;
            const y = clientY - dragOffset.y;
            
            // Calculate viewport constraints more efficiently
            const maxX = window.innerWidth - windowBounds.width;
            const maxY = window.innerHeight - windowBounds.height;
            
            const constrainedX = Math.max(0, Math.min(x, maxX));
            const constrainedY = Math.max(0, Math.min(y, maxY));
            
            // Use transform for better performance (hardware accelerated)
            activeWindow.style.transform = `translate(${constrainedX}px, ${constrainedY}px)`;
            
            // Update position for future operations
            activeWindow.style.left = `${constrainedX}px`;
            activeWindow.style.top = `${constrainedY}px`;
        }

        function stopDrag() {
            if (activeWindow) {
                activeWindow.classList.remove('window-dragging');
                // Reset transform to prevent conflicts
                activeWindow.style.transform = '';
            }
            
            // Cancel any pending animation frame
            if (pendingDrag) {
                cancelAnimationFrame(pendingDrag);
                pendingDrag = null;
            }
            
            isDragging = false;
            activeWindow = null;
            
            // Restore user selection and cursor
            document.body.style.userSelect = '';
            document.body.style.cursor = '';
            
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', stopDrag);
        }

        // Window management keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.altKey && e.key === 'F4') {
                e.preventDefault();
                if (activeWindow) {
                    closeFloatingWindow(activeWindow.id);
                }
            }
        });

        // Click outside to remove focus
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.floating-window')) {
                document.querySelectorAll('.floating-window').forEach(w => w.classList.remove('active'));
                activeWindow = null;
            }
        });
    </script>

    <!-- Floating Windows Container -->
    <div id="floatingWindowsContainer" class="floating-windows-container"></div>
</body>
</html>
